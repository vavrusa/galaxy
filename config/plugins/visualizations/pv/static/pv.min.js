/**
 * PV - WebGL protein viewer v1.5.0dev
 * http://biasmv.github.io/pv
 * 
 * Copyright 2013-2015 Marco Biasini
 * Released under the MIT license
 */
!function(a,b){if("function"==typeof define&&define.amd)define([],b);else{var c=b();a.pv=c,a.io=c.io,a.mol=c.mol,a.color=c.color,a.rgb=c.rgb,a.viewpoint=c.viewpoint,a.vec3=c.vec3,a.vec4=c.vec4,a.mat3=c.mat3,a.mat4=c.mat4,a.quat=c.quat}}(this,function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q;return a=function(){var a={};if(!b)var b=1e-6;if(!c)var c="undefined"!=typeof Float32Array?Float32Array:Array;if(!d)var d=Math.random;var e={};e.setMatrixArrayType=function(a){c=a},a.glMatrix=e;var f={};f.create=function(){var a=new c(3);return a[0]=0,a[1]=0,a[2]=0,a},f.clone=function(a){var b=new c(3);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b},f.fromValues=function(a,b,d){var e=new c(3);return e[0]=a,e[1]=b,e[2]=d,e},f.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a},f.set=function(a,b,c,d){return a[0]=b,a[1]=c,a[2]=d,a},f.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a},f.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a},f.sub=f.subtract,f.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a},f.mul=f.multiply,f.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a},f.div=f.divide,f.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a},f.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a},f.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a},f.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a},f.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return Math.sqrt(c*c+d*d+e*e)},f.dist=f.distance,f.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return c*c+d*d+e*e},f.sqrDist=f.squaredDistance,f.length=function(a){var b=a[0],c=a[1],d=a[2];return Math.sqrt(b*b+c*c+d*d)},f.len=f.length,f.squaredLength=function(a){var b=a[0],c=a[1],d=a[2];return b*b+c*c+d*d},f.sqrLen=f.squaredLength,f.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a},f.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=c*c+d*d+e*e;return f>0&&(f=1/Math.sqrt(f),a[0]=b[0]*f,a[1]=b[1]*f,a[2]=b[2]*f),a},f.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},f.cross=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2];return a[0]=e*i-f*h,a[1]=f*g-d*i,a[2]=d*h-e*g,a},f.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a},f.random=function(a,b){b=b||1;var c=2*d()*Math.PI,e=2*d()-1,f=Math.sqrt(1-e*e)*b;return a[0]=Math.cos(c)*f,a[1]=Math.sin(c)*f,a[2]=e*b,a},f.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2];return a[0]=c[0]*d+c[4]*e+c[8]*f+c[12],a[1]=c[1]*d+c[5]*e+c[9]*f+c[13],a[2]=c[2]*d+c[6]*e+c[10]*f+c[14],a},f.transformMat3=function(a,b,c){var d=b[0],e=b[1],f=b[2];return a[0]=d*c[0]+e*c[3]+f*c[6],a[1]=d*c[1]+e*c[4]+f*c[7],a[2]=d*c[2]+e*c[5]+f*c[8],a},f.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return a[0]=k*j+n*-g+l*-i-m*-h,a[1]=l*j+n*-h+m*-g-k*-i,a[2]=m*j+n*-i+k*-h-l*-g,a},f.forEach=function(){var a=f.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=3),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],a[2]=b[h+2],f(a,a,g),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2];return b}}(),f.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"},a.vec3=f;var g={};g.create=function(){var a=new c(4);return a[0]=0,a[1]=0,a[2]=0,a[3]=0,a},g.clone=function(a){var b=new c(4);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},g.fromValues=function(a,b,d,e){var f=new c(4);return f[0]=a,f[1]=b,f[2]=d,f[3]=e,f},g.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a},g.set=function(a,b,c,d,e){return a[0]=b,a[1]=c,a[2]=d,a[3]=e,a},g.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a},g.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a},g.sub=g.subtract,g.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a[3]=b[3]*c[3],a},g.mul=g.multiply,g.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a[3]=b[3]/c[3],a},g.div=g.divide,g.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a[3]=Math.min(b[3],c[3]),a},g.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a[3]=Math.max(b[3],c[3]),a},g.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a},g.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a[3]=b[3]+c[3]*d,a},g.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return Math.sqrt(c*c+d*d+e*e+f*f)},g.dist=g.distance,g.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return c*c+d*d+e*e+f*f},g.sqrDist=g.squaredDistance,g.length=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return Math.sqrt(b*b+c*c+d*d+e*e)},g.len=g.length,g.squaredLength=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return b*b+c*c+d*d+e*e},g.sqrLen=g.squaredLength,g.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=-b[3],a},g.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f;return g>0&&(g=1/Math.sqrt(g),a[0]=b[0]*g,a[1]=b[1]*g,a[2]=b[2]*g,a[3]=b[3]*g),a},g.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]},g.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2],h=b[3];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a[3]=h+d*(c[3]-h),a},g.random=function(a,b){return b=b||1,a[0]=d(),a[1]=d(),a[2]=d(),a[3]=d(),g.normalize(a,a),g.scale(a,a,b),a},g.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3];return a[0]=c[0]*d+c[4]*e+c[8]*f+c[12]*g,a[1]=c[1]*d+c[5]*e+c[9]*f+c[13]*g,a[2]=c[2]*d+c[6]*e+c[10]*f+c[14]*g,a[3]=c[3]*d+c[7]*e+c[11]*f+c[15]*g,a},g.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return a[0]=k*j+n*-g+l*-i-m*-h,a[1]=l*j+n*-h+m*-g-k*-i,a[2]=m*j+n*-i+k*-h-l*-g,a},g.forEach=function(){var a=g.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=4),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],a[2]=b[h+2],a[3]=b[h+3],f(a,a,g),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2],b[h+3]=a[3];return b}}(),g.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},a.vec4=g;var h={};h.create=function(){var a=new c(9);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},h.fromMat4=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[4],a[4]=b[5],a[5]=b[6],a[6]=b[8],a[7]=b[9],a[8]=b[10],a},h.clone=function(a){var b=new c(9);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b},h.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a},h.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},h.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[5];a[1]=b[3],a[2]=b[6],a[3]=c,a[5]=b[7],a[6]=d,a[7]=e}else a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8];return a},h.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=k*g-h*j,m=-k*f+h*i,n=j*f-g*i,o=c*l+d*m+e*n;return o?(o=1/o,a[0]=l*o,a[1]=(-k*d+e*j)*o,a[2]=(h*d-e*g)*o,a[3]=m*o,a[4]=(k*c-e*i)*o,a[5]=(-h*c+e*f)*o,a[6]=n*o,a[7]=(-j*c+d*i)*o,a[8]=(g*c-d*f)*o,a):null},h.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8];return a[0]=g*k-h*j,a[1]=e*j-d*k,a[2]=d*h-e*g,a[3]=h*i-f*k,a[4]=c*k-e*i,a[5]=e*f-c*h,a[6]=f*j-g*i,a[7]=d*i-c*j,a[8]=c*g-d*f,a},h.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return b*(j*f-g*i)+c*(-j*e+g*h)+d*(i*e-f*h)},h.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1],o=c[2],p=c[3],q=c[4],r=c[5],s=c[6],t=c[7],u=c[8];return a[0]=m*d+n*g+o*j,a[1]=m*e+n*h+o*k,a[2]=m*f+n*i+o*l,a[3]=p*d+q*g+r*j,a[4]=p*e+q*h+r*k,a[5]=p*f+q*i+r*l,a[6]=s*d+t*g+u*j,a[7]=s*e+t*h+u*k,a[8]=s*f+t*i+u*l,a},h.mul=h.multiply,h.translate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1];return a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=m*d+n*g+j,a[7]=m*e+n*h+k,a[8]=m*f+n*i+l,a},h.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=Math.sin(c),n=Math.cos(c);return a[0]=n*d+m*g,a[1]=n*e+m*h,a[2]=n*f+m*i,a[3]=n*g-m*d,a[4]=n*h-m*e,a[5]=n*i-m*f,a[6]=j,a[7]=k,a[8]=l,a},h.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;return a[0]=1-(m+o),a[3]=k+r,a[6]=l-q,a[1]=k-r,a[4]=1-(j+o),a[7]=n+p,a[2]=l+q,a[5]=n-p,a[8]=1-(j+m),a},h.normalFromMat4=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(i*A-g*D-j*z)*E,a[2]=(g*C-h*A+j*y)*E,a[3]=(e*C-d*D-f*B)*E,a[4]=(c*D-e*A+f*z)*E,a[5]=(d*A-c*C-f*y)*E,a[6]=(p*x-q*w+r*v)*E,a[7]=(q*u-o*x-r*t)*E,a[8]=(o*w-p*u+r*s)*E,a):null},h.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"},a.mat3=h;var i={};i.create=function(){var a=new c(16);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},i.fromValues=function(a,b,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=new c(16);return r[0]=a,r[1]=b,r[2]=d,r[3]=e,r[4]=f,r[5]=g,r[6]=h,r[7]=i,r[8]=j,r[9]=k,r[10]=l,r[11]=m,r[12]=n,r[13]=o,r[14]=p,r[15]=q,r},i.clone=function(a){var b=new c(16);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15],b},i.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},i.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},i.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[3],f=b[6],g=b[7],h=b[11];a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=c,a[6]=b[9],a[7]=b[13],a[8]=d,a[9]=f,a[11]=b[14],a[12]=e,a[13]=g,a[14]=h}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a},i.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(e*C-d*D-f*B)*E,a[2]=(p*x-q*w+r*v)*E,a[3]=(m*w-l*x-n*v)*E,a[4]=(i*A-g*D-j*z)*E,a[5]=(c*D-e*A+f*z)*E,a[6]=(q*u-o*x-r*t)*E,a[7]=(k*x-m*u+n*t)*E,a[8]=(g*C-h*A+j*y)*E,a[9]=(d*A-c*C-f*y)*E,a[10]=(o*w-p*u+r*s)*E,a[11]=(l*u-k*w-n*s)*E,a[12]=(h*z-g*B-i*y)*E,a[13]=(c*B-d*z+e*y)*E,a[14]=(p*t-o*v-q*s)*E,a[15]=(k*v-l*t+m*s)*E,a):null},i.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15];return a[0]=h*(m*r-n*q)-l*(i*r-j*q)+p*(i*n-j*m),a[1]=-(d*(m*r-n*q)-l*(e*r-f*q)+p*(e*n-f*m)),a[2]=d*(i*r-j*q)-h*(e*r-f*q)+p*(e*j-f*i),a[3]=-(d*(i*n-j*m)-h*(e*n-f*m)+l*(e*j-f*i)),a[4]=-(g*(m*r-n*q)-k*(i*r-j*q)+o*(i*n-j*m)),a[5]=c*(m*r-n*q)-k*(e*r-f*q)+o*(e*n-f*m),a[6]=-(c*(i*r-j*q)-g*(e*r-f*q)+o*(e*j-f*i)),a[7]=c*(i*n-j*m)-g*(e*n-f*m)+k*(e*j-f*i),a[8]=g*(l*r-n*p)-k*(h*r-j*p)+o*(h*n-j*l),a[9]=-(c*(l*r-n*p)-k*(d*r-f*p)+o*(d*n-f*l)),a[10]=c*(h*r-j*p)-g*(d*r-f*p)+o*(d*j-f*h),a[11]=-(c*(h*n-j*l)-g*(d*n-f*l)+k*(d*j-f*h)),a[12]=-(g*(l*q-m*p)-k*(h*q-i*p)+o*(h*m-i*l)),a[13]=c*(l*q-m*p)-k*(d*q-e*p)+o*(d*m-e*l),a[14]=-(c*(h*q-i*p)-g*(d*q-e*p)+o*(d*i-e*h)),a[15]=c*(h*m-i*l)-g*(d*m-e*l)+k*(d*i-e*h),a},i.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14],q=a[15],r=b*g-c*f,s=b*h-d*f,t=b*i-e*f,u=c*h-d*g,v=c*i-e*g,w=d*i-e*h,x=j*o-k*n,y=j*p-l*n,z=j*q-m*n,A=k*p-l*o,B=k*q-m*o,C=l*q-m*p;return r*C-s*B+t*A+u*z-v*y+w*x},i.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],p=b[12],q=b[13],r=b[14],s=b[15],t=c[0],u=c[1],v=c[2],w=c[3];return a[0]=t*d+u*h+v*l+w*p,a[1]=t*e+u*i+v*m+w*q,a[2]=t*f+u*j+v*n+w*r,a[3]=t*g+u*k+v*o+w*s,t=c[4],u=c[5],v=c[6],w=c[7],a[4]=t*d+u*h+v*l+w*p,a[5]=t*e+u*i+v*m+w*q,a[6]=t*f+u*j+v*n+w*r,a[7]=t*g+u*k+v*o+w*s,t=c[8],u=c[9],v=c[10],w=c[11],a[8]=t*d+u*h+v*l+w*p,a[9]=t*e+u*i+v*m+w*q,a[10]=t*f+u*j+v*n+w*r,a[11]=t*g+u*k+v*o+w*s,t=c[12],u=c[13],v=c[14],w=c[15],a[12]=t*d+u*h+v*l+w*p,a[13]=t*e+u*i+v*m+w*q,a[14]=t*f+u*j+v*n+w*r,a[15]=t*g+u*k+v*o+w*s,a},i.fromMat3=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=0,a[4]=b[3],a[5]=b[4],a[6]=b[5],a[7]=0,a[8]=b[6],a[9]=b[7],a[10]=b[8],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},i.mul=i.multiply,i.translate=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p=c[0],q=c[1],r=c[2];return b===a?(a[12]=b[0]*p+b[4]*q+b[8]*r+b[12],a[13]=b[1]*p+b[5]*q+b[9]*r+b[13],a[14]=b[2]*p+b[6]*q+b[10]*r+b[14],a[15]=b[3]*p+b[7]*q+b[11]*r+b[15]):(d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=j,a[7]=k,a[8]=l,a[9]=m,a[10]=n,a[11]=o,a[12]=d*p+h*q+l*r+b[12],a[13]=e*p+i*q+m*r+b[13],a[14]=f*p+j*q+n*r+b[14],a[15]=g*p+k*q+o*r+b[15]),a},i.scale=function(a,b,c){var d=c[0],e=c[1],f=c[2];return a[0]=b[0]*d,a[1]=b[1]*d,a[2]=b[2]*d,a[3]=b[3]*d,a[4]=b[4]*e,a[5]=b[5]*e,a[6]=b[6]*e,a[7]=b[7]*e,a[8]=b[8]*f,a[9]=b[9]*f,a[10]=b[10]*f,a[11]=b[11]*f,a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},i.rotate=function(a,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=e[0],E=e[1],F=e[2],G=Math.sqrt(D*D+E*E+F*F);return Math.abs(G)<b?null:(G=1/G,D*=G,E*=G,F*=G,f=Math.sin(d),g=Math.cos(d),h=1-g,i=c[0],j=c[1],k=c[2],l=c[3],m=c[4],n=c[5],o=c[6],p=c[7],q=c[8],r=c[9],s=c[10],t=c[11],u=D*D*h+g,v=E*D*h+F*f,w=F*D*h-E*f,x=D*E*h-F*f,y=E*E*h+g,z=F*E*h+D*f,A=D*F*h+E*f,B=E*F*h-D*f,C=F*F*h+g,a[0]=i*u+m*v+q*w,a[1]=j*u+n*v+r*w,a[2]=k*u+o*v+s*w,a[3]=l*u+p*v+t*w,a[4]=i*x+m*y+q*z,a[5]=j*x+n*y+r*z,a[6]=k*x+o*y+s*z,a[7]=l*x+p*y+t*z,a[8]=i*A+m*B+q*C,a[9]=j*A+n*B+r*C,a[10]=k*A+o*B+s*C,a[11]=l*A+p*B+t*C,c!==a&&(a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]),a)},i.rotateX=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[4],g=b[5],h=b[6],i=b[7],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[4]=f*e+j*d,a[5]=g*e+k*d,a[6]=h*e+l*d,a[7]=i*e+m*d,a[8]=j*e-f*d,a[9]=k*e-g*d,a[10]=l*e-h*d,a[11]=m*e-i*d,a},i.rotateY=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e-j*d,a[1]=g*e-k*d,a[2]=h*e-l*d,a[3]=i*e-m*d,a[8]=f*d+j*e,a[9]=g*d+k*e,a[10]=h*d+l*e,a[11]=i*d+m*e,a},i.rotateZ=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[4],k=b[5],l=b[6],m=b[7];return b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e+j*d,a[1]=g*e+k*d,a[2]=h*e+l*d,a[3]=i*e+m*d,a[4]=j*e-f*d,a[5]=k*e-g*d,a[6]=l*e-h*d,a[7]=m*e-i*d,a},i.fromRotationTranslation=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=d+d,i=e+e,j=f+f,k=d*h,l=d*i,m=d*j,n=e*i,o=e*j,p=f*j,q=g*h,r=g*i,s=g*j;return a[0]=1-(n+p),a[1]=l+s,a[2]=m-r,a[3]=0,a[4]=l-s,a[5]=1-(k+p),a[6]=o+q,a[7]=0,a[8]=m+r,a[9]=o-q,a[10]=1-(k+n),a[11]=0,a[12]=c[0],a[13]=c[1],a[14]=c[2],a[15]=1,a},i.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;return a[0]=1-(m+o),a[1]=k+r,a[2]=l-q,a[3]=0,a[4]=k-r,a[5]=1-(j+o),a[6]=n+p,a[7]=0,a[8]=l+q,a[9]=n-p,a[10]=1-(j+m),a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},i.frustum=function(a,b,c,d,e,f,g){var h=1/(c-b),i=1/(e-d),j=1/(f-g);return a[0]=2*f*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*f*i,a[6]=0,a[7]=0,a[8]=(c+b)*h,a[9]=(e+d)*i,a[10]=(g+f)*j,a[11]=-1,a[12]=0,a[13]=0,a[14]=g*f*2*j,a[15]=0,a},i.perspective=function(a,b,c,d,e){var f=1/Math.tan(b/2),g=1/(d-e);return a[0]=f/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=f,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(e+d)*g,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*e*d*g,a[15]=0,a},i.ortho=function(a,b,c,d,e,f,g){var h=1/(b-c),i=1/(d-e),j=1/(f-g);return a[0]=-2*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*i,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*j,a[11]=0,a[12]=(b+c)*h,a[13]=(e+d)*i,a[14]=(g+f)*j,a[15]=1,a},i.lookAt=function(a,c,d,e){var f,g,h,j,k,l,m,n,o,p,q=c[0],r=c[1],s=c[2],t=e[0],u=e[1],v=e[2],w=d[0],x=d[1],y=d[2];return Math.abs(q-w)<b&&Math.abs(r-x)<b&&Math.abs(s-y)<b?i.identity(a):(m=q-w,n=r-x,o=s-y,p=1/Math.sqrt(m*m+n*n+o*o),m*=p,n*=p,o*=p,f=u*o-v*n,g=v*m-t*o,h=t*n-u*m,p=Math.sqrt(f*f+g*g+h*h),p?(p=1/p,f*=p,g*=p,h*=p):(f=0,g=0,h=0),j=n*h-o*g,k=o*f-m*h,l=m*g-n*f,p=Math.sqrt(j*j+k*k+l*l),p?(p=1/p,j*=p,k*=p,l*=p):(j=0,k=0,l=0),a[0]=f,a[1]=j,a[2]=m,a[3]=0,a[4]=g,a[5]=k,a[6]=n,a[7]=0,a[8]=h,a[9]=l,a[10]=o,a[11]=0,a[12]=-(f*q+g*r+h*s),a[13]=-(j*q+k*r+l*s),a[14]=-(m*q+n*r+o*s),a[15]=1,a)},i.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"},a.mat4=i;var j={};return j.create=function(){var a=new c(4);return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a},j.rotationTo=function(){var a=f.create(),b=f.fromValues(1,0,0),c=f.fromValues(0,1,0);return function(d,e,g){var h=f.dot(e,g);return-.999999>h?(f.cross(a,b,e),f.length(a)<1e-6&&f.cross(a,c,e),f.normalize(a,a),j.setAxisAngle(d,a,Math.PI),d):h>.999999?(d[0]=0,d[1]=0,d[2]=0,d[3]=1,d):(f.cross(a,e,g),d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=1+h,j.normalize(d,d))}}(),j.setAxes=function(){var a=h.create();return function(b,c,d,e){return a[0]=d[0],a[3]=d[1],a[6]=d[2],a[1]=e[0],a[4]=e[1],a[7]=e[2],a[2]=c[0],a[5]=c[1],a[8]=c[2],j.normalize(b,j.fromMat3(b,a))}}(),j.clone=g.clone,j.fromValues=g.fromValues,j.copy=g.copy,j.set=g.set,j.identity=function(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a},j.setAxisAngle=function(a,b,c){c=.5*c;var d=Math.sin(c);return a[0]=d*b[0],a[1]=d*b[1],a[2]=d*b[2],a[3]=Math.cos(c),a},j.add=g.add,j.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];return a[0]=d*k+g*h+e*j-f*i,a[1]=e*k+g*i+f*h-d*j,a[2]=f*k+g*j+d*i-e*h,a[3]=g*k-d*h-e*i-f*j,a},j.mul=j.multiply,j.scale=g.scale,j.rotateX=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+g*h,a[1]=e*i+f*h,a[2]=f*i-e*h,a[3]=g*i-d*h,a},j.rotateY=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i-f*h,a[1]=e*i+g*h,a[2]=f*i+d*h,a[3]=g*i-e*h,a},j.rotateZ=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+e*h,a[1]=e*i-d*h,a[2]=f*i+g*h,a[3]=g*i-f*h,a},j.calculateW=function(a,b){var c=b[0],d=b[1],e=b[2];return a[0]=c,a[1]=d,a[2]=e,a[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e)),a},j.dot=g.dot,j.lerp=g.lerp,j.slerp=function(a,b,c,d){var e,f,g,h,i,j=b[0],k=b[1],l=b[2],m=b[3],n=c[0],o=c[1],p=c[2],q=c[3];return f=j*n+k*o+l*p+m*q,0>f&&(f=-f,n=-n,o=-o,p=-p,q=-q),1-f>1e-6?(e=Math.acos(f),g=Math.sin(e),h=Math.sin((1-d)*e)/g,i=Math.sin(d*e)/g):(h=1-d,i=d),a[0]=h*j+i*n,a[1]=h*k+i*o,a[2]=h*l+i*p,a[3]=h*m+i*q,a},j.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f,h=g?1/g:0;return a[0]=-c*h,a[1]=-d*h,a[2]=-e*h,a[3]=f*h,a},j.conjugate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=b[3],a},j.length=g.length,j.len=j.length,j.squaredLength=g.squaredLength,j.sqrLen=j.squaredLength,j.normalize=g.normalize,j.fromMat3=function(){var a="undefined"!=typeof Int8Array?new Int8Array([1,2,0]):[1,2,0];return function(b,c){var d,e=c[0]+c[4]+c[8];if(e>0)d=Math.sqrt(e+1),b[3]=.5*d,d=.5/d,b[0]=(c[7]-c[5])*d,b[1]=(c[2]-c[6])*d,b[2]=(c[3]-c[1])*d;else{var f=0;c[4]>c[0]&&(f=1),c[8]>c[3*f+f]&&(f=2);var g=a[f],h=a[g];d=Math.sqrt(c[3*f+f]-c[3*g+g]-c[3*h+h]+1),b[f]=.5*d,d=.5/d,b[3]=(c[3*h+g]-c[3*g+h])*d,b[g]=(c[3*g+f]+c[3*f+g])*d,b[h]=(c[3*h+f]+c[3*f+h])*d}return b}}(),j.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},a.quat=j,a}(),b=function(){function b(a,b){this._1=a;for(var c=0;c<this._1.length;++c)this._1[c]=g.forceRGB(this._1[c]);this._N=b}function c(a,b,c){this.colorFor=a,this._c4=b,this._cU=c}function d(a,b,c){var d=null,e=null;return a[b](function(a){var b=a.prop(c);return null===d&&null===e?void(d=e=b):(d=Math.min(d,b),void(e=Math.max(e,b)))}),{min:d,max:e}}function e(a,b,e,f,g){return b||(b=k("rainbow")),new c(function(c,d,e){var f=0;this._v!==this._z&&(f=(g(c).prop(a)-this._v)/(this._z-this._v)),m(d,e,b,f)},function(b){return void 0!==e?(this._v=e[0],void(this._z=e[1])):(e=d(b,f,a),this._v=e.min,void(this._z=e.max))},function(){})}var f=a.vec4,g={};g.rgb={};var h=g.rgb;g.rgb.create=f.create,g.rgb.scale=f.scale,g.rgb.copy=f.copy,g.rgb.fromValues=f.fromValues,g.rgb.mix=function(a,b,c,d){var e=1-d;return a[0]=b[0]*d+c[0]*e,a[1]=b[1]*d+c[1]*e,a[2]=b[2]*d+c[2]*e,a[3]=b[3]*d+c[3]*e,a};var i={white:h.fromValues(1,1,1,1),black:h.fromValues(0,0,0,1),grey:h.fromValues(.5,.5,.5,1),lightgrey:h.fromValues(.8,.8,.8,1),darkgrey:h.fromValues(.3,.3,.3,1),red:h.fromValues(1,0,0,1),darkred:h.fromValues(.5,0,0,1),lightred:h.fromValues(1,.5,.5,1),green:h.fromValues(0,1,0,1),darkgreen:h.fromValues(0,.5,0,1),lightgreen:h.fromValues(.5,1,.5,1),blue:h.fromValues(0,0,1,1),darkblue:h.fromValues(0,0,.5,1),lightblue:h.fromValues(.5,.5,1,1),yellow:h.fromValues(1,1,0,1),darkyellow:h.fromValues(.5,.5,0,1),lightyellow:h.fromValues(1,1,.5,1),cyan:h.fromValues(0,1,1,1),darkcyan:h.fromValues(0,.5,.5,1),lightcyan:h.fromValues(.5,1,1,1),magenta:h.fromValues(1,0,1,1),darkmagenta:h.fromValues(.5,0,.5,1),lightmagenta:h.fromValues(1,.5,1,1),orange:h.fromValues(1,.5,0,1),darkorange:h.fromValues(.5,.25,0,1),lightorange:h.fromValues(1,.75,.5,1)};g.hex2rgb=function(a){var b,c,d,e;if(4===a.length||5===a.length){b=parseInt(a[1],16),c=parseInt(a[2],16),d=parseInt(a[3],16),e=15,5===a.length&&(e=parseInt(a[4],16));var f=1/15;return h.fromValues(f*b,f*c,f*d,f*e)}if(7===a.length||9===a.length){b=parseInt(a.substr(1,2),16),c=parseInt(a.substr(3,2),16),d=parseInt(a.substr(5,2),16),e=255,9===a.length&&(e=parseInt(a.substr(7,2),16));var g=1/255;return h.fromValues(g*b,g*c,g*d,g*e)}},g.setColorPalette=function(a){i=a,g.initGradients()},g.forceRGB=function(a){if("string"==typeof a){var b=i[a];if(void 0!==b)return b;if(a.length>0&&"#"===a[0])return g.hex2rgb(a)}return 3===a.length?[a[0],a[1],a[2],1]:a},b.prototype={colorAt:function(a,b){if(b<=this._N[0])return f.copy(a,this._1[0]);if(b>=this._N[this._N.length-1])return f.copy(a,this._1[this._N.length-1]);for(var c=0,d=1;d<this._N.length&&!(this._N[d]>b);++d)c=d;var e=c+1,g=this._N[c],i=this._N[e],j=(b-g)/(i-g);return h.mix(a,this._1[e],this._1[c],j)}};var j={};g.gradient=function(a,c){if("string"==typeof a)return j[a];if(c=c||"equal","equal"===c){c=[];for(var d=0;d<a.length;++d)c.push(1*d/(a.length-1))}return new b(a,c)};var k=g.gradient;g.initGradients=function(){j.rainbow=k(["red","yellow","green","blue"]),j.reds=k(["lightred","darkred"]),j.greens=k(["lightgreen","darkgreen"]),j.blues=k(["lightblue","darkblue"]),j.trafficlight=k(["green","yellow","red"]),j.heatmap=k(["red","white","blue"])},c.prototype={begin:function(a){this._c4&&this._c4(a)},end:function(a){this._cU&&this._cU(a)}},g.ColorOp=c,g.uniform=function(a){return a=g.forceRGB(a||"white"),new c(function(b,c,d){c[d+0]=a[0],c[d+1]=a[1],c[d+2]=a[2],c[d+3]=a[3]},null,null)};var l={H:[1,1,1],C:[.83,.83,.83],N:[.13,.2,1],O:[1,.13,0],F:[.12,.94,.12],CL:[.12,.94,.12],BR:[.6,.13,0],I:[.4,0,.73],HE:[0,1,1],NE:[0,1,1],AR:[0,1,1],XE:[0,1,1],KR:[0,1,1],P:[1,.6,0],S:[.87,.87,0],B:[1,.67,.47],LI:[.47,0,1],NA:[.47,0,1],K:[.47,0,1],RB:[.47,0,1],CS:[.47,0,1],FR:[.47,0,1],BE:[0,.47,0],MG:[0,.47,0],SR:[0,.47,0],BA:[0,.47,0],RA:[0,.47,0],TI:[.6,.6,.6],FE:[.87,.47,0]};g.byElement=function(){return new c(function(a,b,c){var d=a.element(),e=l[d];return void 0!==e?(b[c]=e[0],b[c+1]=e[1],b[c+2]=e[2],b[c+3]=1,b):(b[c]=1,b[c+1]=0,b[c+2]=1,b[c+3]=1,b)},null,null)},g.bySS=function(){return new c(function(a,b,c){switch(a.residue().ss()){case"C":return b[c]=.8,b[c+1]=.8,b[c+2]=.8,void(b[c+3]=1);case"H":return b[c]=.6,b[c+1]=.6,b[c+2]=.9,void(b[c+3]=1);case"E":return b[c]=.2,b[c+1]=.8,b[c+2]=.2,void(b[c+3]=1)}},null,null)},g.rainbow=function(a){a||(a=k("rainbow"));var b=new c(function(b,c,d){var e=0,f=this.chainLimits[b.residue().chain().name()];if(void 0!==f){var g=b.residue().index();e=(g-f[0])/(f[1]-f[0])}var h=[1,1,1,1];a.colorAt(h,e),c[d]=h[0],c[d+1]=h[1],c[d+2]=h[2],c[d+3]=h[3]},function(a){var b=a.chains();this.chainLimits={};for(var c=0;c<b.length;++c){var d=b[c].backboneTraces();if(0!==d.length){for(var e=d[0].residueAt(0).index(),f=d[0].residueAt(d[0].length()-1).index(),g=1;g<d.length;++g){var h=d[g];e=Math.min(e,h.residueAt(0).index()),f=Math.max(f,h.residueAt(h.length()-1).index())}e!==f&&(this.chainLimits[b[c].name()]=[e,f])}}},function(){this.chainLimits=null});return b},g.ssSuccession=function(a,b){a||(a=k("rainbow")),b||(b=g.forceRGB("lightgrey"));var d=new c(function(c,d,e){var f=c.residue().index(),g=this.chainLimits[c.residue().chain().name()],h=g.indices[f];if(-1===h)return d[e]=b[0],d[e+1]=b[1],d[e+2]=b[2],void(d[e+3]=b[3]);var i=0;null===g.max,null!==g.max&&(i=h/(g.max>0?g.max:1));var j=[0,0,0,0];a.colorAt(j,i),d[e]=j[0],d[e+1]=j[1],d[e+2]=j[2],d[e+3]=j[3]},function(a){var b=a.chains();this.chainLimits={};for(var c=0;c<b.length;++c){for(var d=b[c].residues(),e=null,f={},g=0,h="C",i=0;i<d.length;++i){var j=d[i].ss();"C"===j?("C"!==h&&g++,f[d[i].index()]=-1):(e=g,f[d[i].index()]=g),h=j}this.chainLimits[b[c].name()]={indices:f,max:e}}},function(){this.chainLimits=null});return d},g.byChain=function(a){a||(a=k("rainbow"));var b=new c(function(b,c,d){var e=this.chainIndices[b.residue().chain().name()],f=e*this.scale,g=[0,0,0,0];a.colorAt(g,f),c[d+0]=g[0],c[d+1]=g[1],c[d+2]=g[2],c[d+3]=g[3]},function(a){var b=a.chains();this.chainIndices={};for(var c=0;c<b.length;++c)this.chainIndices[b[c].name()]=c;this.scale=b.length>1?1/(b.length-1):1},function(){this.chainIndices=null});return b};var m=function(){var a=f.create();return function(b,c,d,e){d.colorAt(a,e),b[c+0]=a[0],b[c+1]=a[1],b[c+2]=a[2],b[c+3]=a[3]}}();return g.byAtomProp=function(a,b,c){return e(a,b,c,"eachAtom",function(a){return a})},g.byResidueProp=function(a,b,c){return e(a,b,c,"eachResidue",function(a){return a.residue()})},g.interpolateColor=function(a,b){for(var c=new Float32Array(4*(b*(a.length/4-1)+1)),d=0,e=f.create(),g=f.create(),h=1/b,i=0;i<a.length/4-1;++i){f.set(e,a[4*i+0],a[4*i+1],a[4*i+2],a[4*i+3]),f.set(g,a[4*i+4],a[4*i+5],a[4*i+6],a[4*i+7]);for(var j=0;b>j;++j){var k=h*j;c[d+0]=e[0]*(1-k)+g[0]*k,c[d+1]=e[1]*(1-k)+g[1]*k,c[d+2]=e[2]*(1-k)+g[2]*k,c[d+3]=e[3]*(1-k)+g[3]*k,d+=4}}return c[d+0]=g[0],c[d+1]=g[1],c[d+2]=g[2],c[d+3]=g[3],c},g.initGradients(),g}(),c=function(){function a(a,b){this.near=a,this.far=b}function b(a){a=a||{},this._5=a.near||.1,this._W=a.far||400}function c(){this._W=100}return b.prototype.update=function(){return new a(this._5,this._W)},c.prototype.update=function(b,c){for(var d=c.center(),e=null,f=0;f<b.length;++f){var g=b[f];g.visible()&&(e=g.updateSquaredSphereRadius(d,e))}if(null===e)return null;e=Math.sqrt(e);var h=c.zoom(),i=1.05*(e+h),j=.1;return new a(j,i)},{FixedSlab:b,AutoSlab:c,Slab:a}}(),d=function(){function a(a,b,c){this._cv=a,this._be=b,this._bw=b,this._dM=c}function b(){this._k={},this._cj=0,this._bl=[]}return a.prototype={nextId:function(a){var b=this._bw;return this._bw++,this._cv._k[b]=a,b},recycle:function(){this._cv.recycle(this)},length:function(){return this._dM-this._be}},b.prototype={getContinuousRange:function(b){for(var c=-1,d=null,e=0;e<this._bl.length;++e){var f=this._bl[e],g=f.length();g>=b&&(null===d||d>g)&&(d=g,c=e)}if(-1!==c){var h=this._bl[c];return this._bl.splice(c,1),h}var i=this._cj,j=i+b;return j>65536?null:(this._cj=j,new a(this,i,j))},recycle:function(a){for(var b=a._be;b<a._bw;++b)delete this._k[b];a._bw=a._be,this._bl.push(a)},objectForId:function(a){return this._k[a]}},b}(),e=function(){function a(a,b){return b>a}function b(a,b){void 0===a||void 0===b?(this._bF=!0,this._v=this._z=null):(this._bF=!1,this._v=a,this._z=b)}var c={};return c.derive=function(a,b,c){for(var d in b.prototype)a.prototype[d]=b.prototype[d];if(void 0!==c)for(var e in c)a.prototype[e]=c[e]},c.bind=function(a,b){return function(){return b.apply(a,arguments)}},c.copy=function(a){a=a||{};var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},c.binarySearch=function(b,c,d){if(0===b.length)return-1;d=d||a;for(var e=0,f=b.length,g=e+f>>1;;){var h=b[g];if(d(c,h))f=g;else{if(!d(h,c))return g;e=g}var i=e+f>>1;if(i===g)return-1;g=i}return-1},c.indexFirstLargerEqualThan=function(b,c,d){if(d=d||a,0===b.length||d(b[b.length-1],c))return-1;for(var e=0,f=b.length,g=e+f>>1;;){var h=b[g];d(c,h)?f=g:d(h,c)?e=g+1:f=g;var i=e+f>>1;if(i===g)return g;g=i}},c.indexLastSmallerThan=function(b,c,d){if(d=d||a,0===b.length||d(b[b.length-1],c))return b.length-1;if(d(c,b[0])||!d(b[0],c))return-1;for(var e=0,f=b.length,g=e+f>>1;;){var h=b[g];d(c,h)||!d(h,c)?f=g:e=g;var i=e+f>>1;if(i===g)return g;g=i}},c.indexLastSmallerEqualThan=function(b,c,d){if(d=d||a,0===b.length||d(b[b.length-1],c))return b.length-1;if(d(c,b[0]))return-1;for(var e=0,f=b.length,g=e+f>>1;;){var h=b[g];d(c,h)?f=g:e=g;var i=e+f>>1;if(i===g)return g;g=i}},b.prototype={min:function(){return this._v},max:function(){return this._z},length:function(){return this._z-this._v},empty:function(){return this._bF},center:function(){return.5*(this._z+this._v)},extend:function(a){this._v-=a,this._z+=a},update:function(a){return this._bF?(this._v=this._z=a,void(this._bF=!1)):void(a<this._v?this._v=a:a>this._z&&(this._z=a))}},c.Range=b,c}(),f=function(){function a(a,b){this._q=b.width,this._r=b.height,this._c1=this._q,this._c2=this._r,this._b=a,this._c0=a.createFramebuffer(),a.bindFramebuffer(a.FRAMEBUFFER,this._c0),this._bm=a.createRenderbuffer(),a.bindRenderbuffer(a.RENDERBUFFER,this._bm),a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,this._q,this._r),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,this._bm),this._bo=a.createTexture(),this._dJ()}return a.prototype={width:function(){return this._q},height:function(){return this._r},bind:function(){var a=this._b;a.bindFramebuffer(a.FRAMEBUFFER,this._c0),a.bindRenderbuffer(a.RENDERBUFFER,this._bm),(this._c1!==this._q||this._c2!==this._r)&&this._dj(),a.viewport(0,0,this._q,this._r)},colorTexture:function(){return this._bo},_dJ:function(){this.bind();
var a=this._b;a.bindTexture(a.TEXTURE_2D,this._bo),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,this._q,this._r,0,a.RGBA,a.UNSIGNED_BYTE,null),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this._bo,0),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.bindTexture(a.TEXTURE_2D,null),this.release()},_dj:function(){var a=this._b;a.bindRenderbuffer(a.RENDERBUFFER,this._bm),a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,this._q,this._r),a.bindTexture(a.TEXTURE_2D,this._bo),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,this._q,this._r,0,a.RGBA,a.UNSIGNED_BYTE,null),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this._bo,0),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,this._bm),a.bindTexture(a.TEXTURE_2D,null),this._c1=this._q,this._c2=this._r},resize:function(a,b){this._q=a,this._r=b},release:function(){var a=this._b;a.bindFramebuffer(a.FRAMEBUFFER,null),a.bindRenderbuffer(a.RENDERBUFFER,null)}},a}(),g=function(){function a(a){this._bk=[],this._dV=a}return a.prototype.request=function(a){for(var b=-1,c=null,d=0;d<this._bk.length;++d){var e=this._bk[d],f=e.length;f>=a&&(null===c||c>f)&&(c=f,b=d)}if(-1!==b){var g=this._bk[b];return this._bk.splice(b,1),g}return new this._dV(a)},a.prototype.release=function(a){this._bk.push(a)},a}(),h=function(){function b(a){this._bP=d.create(),this._J=d.create(),this._cA=d.create(),this._m=d.create(),this._bs=d.create(),this._5=.1,this._W=4e3,this._cN=-5,this._cO=50,this._bE=!0,this._cM=45*Math.PI/180,this._cP=c.fromValues(1,1,1),this._dq=c.fromValues(.1,.1,.1),this._O=c.create(),this._L=50,this._bc=!0,this._F=!0,this._ci=1,this._b=a,this._b9=null,this._bd=0,this.setViewportSize(a.viewportWidth,a.viewportHeight)}var c=a.vec3,d=a.mat4;return b.prototype={_cJ:function(){this._bd+=1,this._bd>68719476735&&(this._bd=0)},setRotation:function(a){16===a.length?d.copy(this._m,a):d.fromMat3(this._m,a),this._F=!0},upsamplingFactor:function(){return this._ci},setUpsamplingFactor:function(a){this._ci=a},mainAxes:function(){return[c.fromValues(this._m[0],this._m[4],this._m[8]),c.fromValues(this._m[1],this._m[5],this._m[9]),c.fromValues(this._m[2],this._m[6],this._m[10])]},fieldOfViewY:function(){return this._cM},aspectRatio:function(){return this._q/this._r},rotation:function(){return this._m},_db:function(){var a=!1;return this._F&&(d.identity(this._J),d.translate(this._J,this._J,[-this._O[0],-this._O[1],-this._O[2]]),d.mul(this._J,this._m,this._J),d.identity(this._bs),d.translate(this._bs,this._bs,[0,0,-this._L]),d.mul(this._J,this._bs,this._J),a=!0),this._bc&&(d.identity(this._bP),d.perspective(this._bP,this._cM,this._q/this._r,this._5,this._W),a=!0),this._bc=!1,this._F=!1,a&&this._cJ(),a},setViewportSize:function(a,b){this._bc=!0,this._q=a,this._r=b},viewportWidth:function(){return this._q},viewportHeight:function(){return this._r},setCenter:function(a){this._F=!0,c.copy(this._O,a)},fog:function(a){return void 0!==a&&a!==this._bE&&(this._bE=a,this._cJ()),this._bE},rotateZ:function(){var a=d.create();return function(b){d.identity(a),this._F=!0,d.rotate(a,a,b,[0,0,1]),d.mul(this._m,a,this._m)}}(),rotateX:function(){var a=d.create();return function(b){d.identity(a),this._F=!0,d.rotate(a,a,b,[1,0,0]),d.mul(this._m,a,this._m)}}(),rotateY:function(){var a=d.create();return function(b){d.identity(a),this._F=!0,d.rotate(a,a,b,[0,1,0]),d.mul(this._m,a,this._m)}}(),panX:function(a){return this.panXY(a,0)},panY:function(a){return this.panXY(0,a)},panXY:function(){var a=d.create(),b=c.create();return function(e,f){d.transpose(a,this._m),this._F=!0,c.set(b,-e,f,0),c.transformMat4(b,b,a),c.add(b,b,this._O),this.setCenter(b)}}(),nearOffset:function(){return this._5},farOffset:function(){return this._W},setNearFar:function(a,b){(a!==this._5||b!==this._W)&&(this._5=a,this._W=b,this._bc=!0)},setFogNearFar:function(a,b){this._cN=a,this._cO=b,this._bc=!0},setZoom:function(a){return this._F=!0,this._L=a,this._L},zoom:function(a){if(void 0===a)return this._L;this._F=!0;var b=1+.1*a;return this._L=Math.min(1e3,Math.max(2,b*this._L)),this._L},center:function(){return this._O},setFogColor:function(a){this._cP=c.clone(a)},currentShader:function(){return this._b9},bind:function(a,b){var c=!1,e=this._b;if(this._b9!==a&&(this._b9=a,e.useProgram(a),c=!0),c=this._db()||c,b?(d.mul(this._cA,this._J,b),e.uniformMatrix4fv(a.modelview,!1,this._cA)):e.uniformMatrix4fv(a.modelview,!1,this._J),this._bd!==a.stateId){a.stateId=this._bd,e.uniformMatrix4fv(a.projection,!1,this._bP),a.rotation&&e.uniformMatrix4fv(a.rotation,!1,this._m),e.uniform1i(a.fog,this._bE);var f=this._L;e.uniform1f(a.fogFar,this._cO+f),e.uniform1f(a.fogNear,this._cN+f),e.uniform3fv(a.fogColor,this._cP),e.uniform3fv(a.outlineColor,this._dq)}}},b}(),i={LINES_FS:"\nprecision ${PRECISION} float;\n\nvarying vec4 vertColor;\nvarying vec3 vertNormal;\nuniform float fogNear;\nuniform float fogFar;\nuniform vec3 fogColor;\nuniform bool fog;\n\nvoid main(void) {\n  gl_FragColor = vec4(vertColor);\n  if (gl_FragColor.a == 0.0) { discard; }\n  float depth = gl_FragCoord.z / gl_FragCoord.w;\n  if (fog) {\n    float fog_factor = smoothstep(fogNear, fogFar, depth);\n    gl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w),\n                        fog_factor);\n  }\n}",HEMILIGHT_FS:"\nprecision ${PRECISION} float;\n\nvarying vec4 vertColor;\nvarying vec3 vertNormal;\nuniform float fogNear;\nuniform float fogFar;\nuniform vec3 fogColor;\nuniform bool fog;\n\nvoid main(void) {\n  float dp = dot(vertNormal, vec3(0.0, 0.0, 1.0));\n  float hemi = max(0.0, dp)*0.5+0.5;\n  hemi *= vertColor.a;\n  gl_FragColor = vec4(vertColor.rgb*hemi, vertColor.a);\n  if (gl_FragColor.a == 0.0) { discard; }\n  float depth = gl_FragCoord.z / gl_FragCoord.w;\n  if (fog) {\n    float fog_factor = smoothstep(fogNear, fogFar, depth);\n    gl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w),\n                        fog_factor);\n  }\n}",HEMILIGHT_VS:"\nattribute vec3 attrPos;\nattribute vec4 attrColor;\nattribute vec3 attrNormal;\n\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nvarying vec4 vertColor;\nvarying vec3 vertNormal;\nvoid main(void) {\n  gl_Position = projectionMat * modelviewMat * vec4(attrPos, 1.0);\n  vec4 n = (modelviewMat * vec4(attrNormal, 0.0));\n  vertNormal = n.xyz;\n  vertColor = attrColor;\n}",OUTLINE_FS:"\nprecision ${PRECISION} float;\nvarying float vertAlpha;\n\nuniform vec3 outlineColor;\nuniform float fogNear;\nuniform float fogFar;\nuniform vec3 fogColor;\nuniform bool fog;\n\nvoid main() {\n  gl_FragColor = vec4(outlineColor, vertAlpha);\n  if (gl_FragColor.a == 0.0) { discard; }\n  float depth = gl_FragCoord.z / gl_FragCoord.w;\n  if (fog) { \n    float fog_factor = smoothstep(fogNear, fogFar, depth);\n    gl_FragColor = mix(gl_FragColor, vec4(fogColor, vertAlpha),\n                        fog_factor);\n  }\n}",OUTLINE_VS:"\nprecision ${PRECISION} float;\n\nattribute vec3 attrPos;\nattribute vec3 attrNormal;\nattribute vec4 attrColor;\n                                                                       \nuniform vec3 outlineColor;\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nvarying float vertAlpha;\n\nvoid main(void) {\n  gl_Position = projectionMat * modelviewMat * vec4(attrPos, 1.0);\n  vec4 normal = modelviewMat * vec4(attrNormal, 0.0);\n  vertAlpha = attrColor.a;\n  gl_Position.xy += normal.xy*0.200;\n}",TEXT_VS:"\nprecision ${PRECISION} float;\n\nattribute vec3 attrCenter;\nattribute vec2 attrCorner;\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nuniform mat4 rotationMat;\nvarying vec2 vertTex;\nuniform float width;\nuniform float height;\nvoid main() { \n  vec4 pos = modelviewMat* vec4(attrCenter, 1.0);\n  pos.z += 4.0;\n  gl_Position = projectionMat * pos;\n  gl_Position.xy += vec2(width,height)*attrCorner*gl_Position.w; \n  vertTex = (attrCorner+abs(attrCorner))/(2.0*abs(attrCorner)); \n}",TEXT_FS:"\nprecision ${PRECISION} float;\n\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nuniform sampler2D sampler;\nuniform float xScale;\nuniform float yScale;\nvarying vec2 vertTex;\nvoid main() { \n  vec2 texCoord = vec2(vertTex.x*xScale, vertTex.y*yScale);\n  gl_FragColor = texture2D(sampler, texCoord);\n  if (gl_FragColor.a == 0.0) { discard; }\n}",SELECT_VS:"\nprecision ${PRECISION} float;\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nattribute vec3 attrPos;\nattribute float attrObjId;\n\nvarying float objId;\n\nvoid main(void) {\n  gl_Position = projectionMat * modelviewMat * vec4(attrPos, 1.0);\n  objId = attrObjId;\n}",SELECT_FS:"\nprecision ${PRECISION} float;\n\nvarying float objId;\nuniform int symId;\n\nint intMod(int x, int y) { \n  int z = x/y;\n  return x-y*z;\n}\nvoid main(void) {\n  // ints are only required to be 7bit...\n  int integralObjId = int(objId+0.5);\n  int red = intMod(integralObjId, 256);\n  integralObjId/=256;\n  int green = intMod(integralObjId, 256);\n  integralObjId/=256;\n  int blue = symId;\n  gl_FragColor = vec4(float(red), float(green), float(blue), 255.0)/255.0;\n}"},j=function(){function a(a,b,c){this._7=a,this._7.addEventListener("touchmove",e.bind(this,this._de)),this._7.addEventListener("touchstart",e.bind(this,this._dd)),this._7.addEventListener("touchend",e.bind(this,this._ck)),this._7.addEventListener("touchcancel",e.bind(this,this._ck)),this._2={scale:1,rotation:0,center:null},this._bA=null,this._cg=b,this._d=c}function b(a){for(var b=0,c=0,d=0;d<a.length;++d)b+=a[d].clientX,c+=a[d].clientY;return b/=a.length,c/=a.length,{x:b,y:c}}function c(a,b){var c=b.x-a.x,d=b.y-a.y;return Math.sqrt(c*c+d*d)}function d(a,b){var d=c(a[0],a[1]),e=c(b[0],b[1]);return e/(0===d?1:d)}function f(a,b){var c=b.x-a.x,d=b.y-a.y;return Math.atan2(d,c)}function g(a,b){return f(b[1],b[0])-f(a[1],a[0])}return a.prototype={_cS:function(a,c){var e={};e.center=b(c.targetTouches),e.pointers=[];for(var f=0;f<c.targetTouches.length;++f){var h=c.targetTouches[f];e.pointers.push({x:h.clientX,y:h.clientY})}return e.numTouches=c.targetTouches.length,e.rotation=0,e.scale=1,e.deltaScale=0,e.deltaRotation=0,a.center&&(e.deltaCenter={x:e.center.x-a.center.x,y:e.center.y-a.center.y}),2!==a.numTouches||2!==e.numTouches?e:(e.initialPointers=a.initialPointers?a.initialPointers:a.pointers,e.scale=d(e.initialPointers,e.pointers),e.deltaScale=e.scale-a.scale,e.rotation=g(e.initialPointers,e.pointers),e.deltaRotation=e.rotation-a.rotation,e)},_de:function(a){a.preventDefault();var b=this._cS(this._2,a),c=4*-b.deltaScale;0!==c&&this._d.zoom(c),2===b.numTouches&&2===this._2.numTouches&&this._d.panXY(.001*b.deltaCenter.x*this._d.zoom(),.001*b.deltaCenter.y*this._d.zoom());var d=-b.deltaRotation;this._d.rotateZ(d),1===b.numTouches&&1===this._2.numTouches&&(this._d.rotateX(.005*b.deltaCenter.y),this._d.rotateY(.005*b.deltaCenter.x)),this._cg.requestRedraw(),this._2=b},_dd:function(a){if(a.preventDefault(),1===a.targetTouches.length){var b=(new Date).getTime();if(null!==this._bA){var c=b-this._bA;500>c&&this._cg._cy({clientX:a.targetTouches[0].clientX,clientY:a.targetTouches[0].clientY})}this._bA=b}else this._bA=null;this._2=this._cS(this._2,a)},_ck:function(a){a.preventDefault()}},a}(),k=function(){function b(a,b,c){return c?a*b:b*(a-1)+1}function c(a,c,d,f,g,h){g=g||!1,f=f||.5;var i=null,j=3*b(c,d,g);i=h?h.request(j):new Float32Array(j);var l,m,n,o=0,p=1/d,q=e.create(),r=e.create(),s=e.create(),t=e.create(),u=e.create(),v=e.create();for(e.set(t,a[0],a[1],a[2]),e.set(u,a[3],a[4],a[5]),g?(e.set(s,a[a.length-3],a[a.length-2],a[a.length-1]),e.sub(q,u,s),e.scale(q,q,f)):(e.set(s,a[0],a[1],a[2]),e.set(q,0,0,0)),l=1,n=c-1;n>l;++l){for(e.set(v,a[3*(l+1)],a[3*(l+1)+1],a[3*(l+1)+2]),e.sub(r,v,t),e.scale(r,r,f),m=0;d>m;++m)k(i,t,q,u,r,p*m,o),o+=3;e.copy(s,t),e.copy(t,u),e.copy(u,v),e.copy(q,r)}for(g?(e.set(v,a[0],a[1],a[3]),e.sub(r,v,t),e.scale(r,r,f)):e.set(r,0,0,0),m=0;d>m;++m)k(i,t,q,u,r,p*m,o),o+=3;if(!g)return i[o]=a[3*(c-1)+0],i[o+1]=a[3*(c-1)+1],i[o+2]=a[3*(c-1)+2],i;for(e.copy(s,t),e.copy(t,u),e.copy(u,v),e.copy(q,r),e.set(v,a[3],a[4],a[5]),e.sub(r,v,t),e.scale(r,r,f),m=0;d>m;++m)k(i,t,q,u,r,p*m,o),o+=3;return i}function d(a,b){this._O=a||e.create(),this._dl=b||1}var e=a.vec3,f=a.mat3,g=a.quat,h=function(){var a=e.create();return function(b,c,d){return e.cross(a,b,c),Math.atan2(e.dot(a,d),e.dot(b,c))}}(),i=function(){var a=e.create();return function(b,c){return e.copy(a,c),Math.abs(c[0])<Math.abs(c[1])?Math.abs(c[0])<Math.abs(c[2])?a[0]+=1:a[2]+=1:Math.abs(c[1])<Math.abs(c[2])?a[1]+=1:a[2]+=1,e.cross(b,c,a)}}(),j=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=f*f,j=f*g,k=f*h,l=g*g,m=g*h,n=h*h;return a[0]=i+e-i*e,a[1]=j-e*j-d*h,a[2]=k-e*k+d*g,a[3]=j-e*j+d*h,a[4]=l+e-e*l,a[5]=m-e*m-d*f,a[6]=k-e*k-d*g,a[7]=m-e*m+d*f,a[8]=n+e-e*n,a},k=function(){var a=e.create();return function(b,c,d,f,g,h,i){var j=h*h,k=3-2*h,l=j*k,m=1-l,n=j*(h-2)+h,o=j*(h-1);e.copy(a,c),e.scale(a,a,m),e.scaleAndAdd(a,a,d,n),e.scaleAndAdd(a,a,f,l),e.scaleAndAdd(a,a,g,o),b[i]=a[0],b[i+1]=a[1],b[i+2]=a[2]}}(),l=function(){var a=f.create(),b=f.create(),c=f.create(),d=f.create(),h=g.create(),i=e.create(),j=e.create();return function(k){for(var l=24,m=g.fromValues(0,0,0,1),n=0;l>n;++n){f.fromQuat(a,m);var o=f.transpose(c,a);f.mul(b,a,f.mul(d,k,o)),e.set(i,b[5],b[2],b[1]),e.set(j,Math.abs(i[0]),Math.abs(i[1]),Math.abs(i[2]));var p=j[0]>j[1]&&j[0]>j[2]?0:j[1]>j[2]?1:2,q=(p+1)%3,r=(p+2)%3;if(0===i[p])break;var s=(b[3*r+r]-b[3*q+q])/(2*i[p]),t=s>0?1:-1;s*=t;var u=s+(1e6>s?Math.sqrt(s*s+1):s),v=t/u,w=1/Math.sqrt(v*v+1);if(1===w)break;if(e.set(h,0,0,0,0),h[p]=t*Math.sqrt((1-w)/2),h[p]*=-1,h[3]=Math.sqrt(1-h[p]*h[p]),1===h[3])break;m=g.mul(m,m,h),g.normalize(m,m)}return m}}();d.prototype.center=function(){return this._O},d.prototype.radius=function(){return this._dl};var m=function(){return function(a,b,c,d,f){f?e.cross(d,b,c):i(d,b),e.cross(c,d,b),e.normalize(d,d),e.normalize(c,c),a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=d[0],a[4]=d[1],a[5]=d[2],a[6]=b[0],a[7]=b[1],a[8]=b[2]}}();return{signedAngle:h,axisRotation:j,ortho:i,diagonalizer:l,catmullRomSpline:c,cubicHermiteInterpolate:k,catmullRomSplineNumPoints:b,Sphere:d,buildRotation:m}}(),l=function(){function b(a,b){this._e=b,this._bJ=a,this._g=new Uint16Array(3*b*a*2),this._l=new Float32Array(3*b*a);var c,d,e=Math.PI/(a-1),f=2*Math.PI/b;for(c=0;c<this._bJ;++c){var g=Math.sin(c*e),h=Math.cos(c*e);for(d=0;d<this._e;++d){var i=g*Math.cos(d*f),j=g*Math.sin(d*f);this._l[3*(d+c*this._e)]=i,this._l[3*(d+c*this._e)+1]=j,this._l[3*(d+c*this._e)+2]=h}}var k=0;for(c=0;c<this._bJ-1;++c)for(d=0;d<this._e;++d)this._g[k]=c*this._e+d,this._g[k+1]=c*this._e+(d+1)%this._e,this._g[k+2]=(c+1)*this._e+d,k+=3,this._g[k]=c*this._e+(d+1)%this._e,this._g[k+1]=(c+1)*this._e+(d+1)%this._e,this._g[k+2]=(c+1)*this._e+d,k+=3}function c(a,b,c){var d=k.catmullRomSpline(a,a.length/3,b,c,!0);this._g=new Uint16Array(2*d.length),this._l=d,this._H=new Float32Array(d.length),this._e=d.length/3;for(var f=e.create(),g=0;g<this._e;++g){var h=0===g?this._e-1:g-1,i=g===this._e-1?0:g+1;f[0]=this._l[3*i+1]-this._l[3*h+1],f[1]=this._l[3*h]-this._l[3*i],e.normalize(f,f),this._H[3*g]=f[0],this._H[3*g+1]=f[1],this._H[3*g+2]=f[2]}for(g=0;g<this._e;++g)this._g[6*g]=g,this._g[6*g+1]=g+this._e,this._g[6*g+2]=(g+1)%this._e+this._e,this._g[6*g+3]=g,this._g[6*g+4]=(g+1)%this._e+this._e,this._g[6*g+5]=(g+1)%this._e}function d(a){this._e=a,this._g=new Uint16Array(3*a*2),this._l=new Float32Array(3*a*2),this._H=new Float32Array(3*a*2);for(var b=2*Math.PI/this._e,c=0;c<this._e;++c){var d=Math.cos(b*c),e=Math.sin(b*c);this._l[3*c]=d,this._l[3*c+1]=e,this._l[3*c+2]=-.5,this._l[3*a+3*c]=d,this._l[3*a+3*c+1]=e,this._l[3*a+3*c+2]=.5,this._H[3*c]=d,this._H[3*c+1]=e,this._H[3*a+3*c]=d,this._H[3*a+3*c+1]=e}for(c=0;c<this._e;++c)this._g[6*c]=c%this._e,this._g[6*c+1]=a+(c+1)%this._e,this._g[6*c+2]=(c+1)%this._e,this._g[6*c+3]=c%this._e,this._g[6*c+4]=a+c%this._e,this._g[6*c+5]=a+(c+1)%this._e}var e=a.vec3;return b.prototype={addTransformed:function(){var a=e.create(),b=e.create();return function(c,d,f,g,h){for(var i=c.numVerts(),j=0;j<this._bJ*this._e;++j)e.set(b,this._l[3*j],this._l[3*j+1],this._l[3*j+2]),e.copy(a,b),e.scale(a,a,f),e.add(a,a,d),c.addVertex(a,b,g,h);for(j=0;j<this._g.length/3;++j)c.addTriangle(i+this._g[3*j],i+this._g[3*j+1],i+this._g[3*j+2])}}(),numIndices:function(){return this._g.length},numVerts:function(){return this._l.length/3}},c.prototype={addTransformed:function(){var a=e.create(),b=e.create();return function(c,d,f,g,h,i,j,k){for(var l=this._e,m=this._H,n=this._l,o=c.numVerts()-l,p=0;l>p;++p)e.set(a,f*n[3*p],f*n[3*p+1],0),e.transformMat3(a,a,g),e.add(a,a,d),e.set(b,m[3*p],m[3*p+1],0),e.transformMat3(b,b,g),c.addVertex(a,b,h,k);if(!i)if(0!==j)for(p=0;l>p;++p)c.addTriangle(o+(p+j)%l,o+p+l,o+(p+1)%l+l),c.addTriangle(o+(p+j)%l,o+(p+1)%l+l,o+(p+1+j)%l);else for(p=0;p<this._g.length/3;++p)c.addTriangle(o+this._g[3*p],o+this._g[3*p+1],o+this._g[3*p+2])}}()},d.prototype={numVerts:function(){return this._l.length/3},numIndices:function(){return this._g.length},addTransformed:function(){var a=e.create(),b=e.create();return function(c,d,f,g,h,i,j,k,l){for(var m=c.numVerts(),n=this._l,o=this._H,p=this._e,q=0;2*p>q;++q){e.set(a,g*n[3*q],g*n[3*q+1],f*n[3*q+2]),e.transformMat3(a,a,h),e.add(a,a,d),e.set(b,o[3*q],o[3*q+1],o[3*q+2]),e.transformMat3(b,b,h);var r=p>q?k:l;c.addVertex(a,b,p>q?i:j,r)}var s=this._g;for(q=0;q<s.length/3;++q)c.addTriangle(m+s[3*q],m+s[3*q+1],m+s[3*q+2])}}()},{TubeProfile:c,ProtoCylinder:d,ProtoSphere:b}}(),m=M=function(){function a(a){this._bp=[],this._M=!0,this._D=name||"",this._b=a,this._bR=1}return a.prototype={order:function(a){return void 0!==a&&(this._bR=a),this._bR},add:function(a){this._bp.push(a)},draw:function(a,b,c,d){for(var e=0,f=this._bp.length;e!==f;++e)this._bp[e].draw(a,b,c,d)},show:function(){this._M=!0},hide:function(){this._M=!1},name:function(a){return void 0!==a&&(this._D=a),this._D},destroy:function(){for(var a=0;a<this._bp.length;++a)this._bp[a].destroy()},visible:function(){return this._M}},a}(),n=P=function(){function b(a,b){a.eachResidue(function(a){var c=a.centralAtom();null!==c&&b(c,c.pos())})}function c(a){M.call(this,a),this._b0=[],this._Q=[],this._co=null}var d=a.vec3,f=function(){var a=d.create();return function(b,c,e){for(var f=0;f<c.length;++f)for(var g=c[f],h=b.chainsByName(g.chains()),i=0;i<g.matrices().length;++i)for(var j=g.matrix(i),k=0;k<h.length;++k)for(var l=h[k],m=0;m<l.residues().length;++m){var n=l.residues()[m].centralAtom();null!==n&&(d.transformMat4(a,n.pos(),j),e(n,a))}}}();return e.derive(c,M,{setShowRelated:function(a){return a&&"asym"!==a&&null===this.structure().assembly(a)?void 0:(this._co=a,a)},symWithIndex:function(a){if("asym"===this.showRelated())return null;var b=this.structure().assembly(this.showRelated());if(!b)return null;for(var c=b.generators(),d=0;d<c.length;++d){if(c[d].matrices().length>a)return c[d].matrix(a);a-=c[d].matrices().length}return null},showRelated:function(){return this._co},select:function(a){return this.structure().select(a)},structure:function(){return this._Q[0]._i},getColorForAtom:function(a,b){return this._Q[0].getColorForAtom(a,b)},addIdRange:function(a){this._b0.push(a)},destroy:function(){M.prototype.destroy.call(this);for(var a=0;a<this._b0.length;++a)this._b0[a].recycle()},eachCentralAtom:function(a){var c=this,d=c.structure(),e=d.assembly(c.showRelated());return null===e?b(d,a):f(d,e.generators(),a)},addVertAssoc:function(a){this._Q.push(a)},_bH:function(a){for(var b=this.vertArrays(),c=[],d={},e=0;e<a.length;++e)d[a[e]]=!0;for(var f=0;f<b.length;++f)d[b[f].chain()]===!0&&c.push(b[f]);return c},_dN:function(a,b,c){for(var d=c.generators(),e=0;e<d.length;++e){var f=d[e],g=this._bH(f.chains());this._b6(a,b,g,f.matrices())}},_da:function(a,b,c,d,e,f){for(var g=this.vertArrays(),h=0;h<g.length;++h)g[h].updateProjectionIntervals(a,b,c,d,e,f)},updateProjectionIntervals:function(a,b,c,d,e,f){if(this._M){var g=this.showRelated();if("asym"===g)return this._da(a,b,c,d,e,f);for(var h=this.structure().assembly(g),i=h.generators(),j=0;j<i.length;++j)for(var k=i[j],l=this._bH(k.chains()),m=0;m<k.matrices().length;++m)for(var n=0;n<l.length;++n){var o=k.matrix(m);l[n].updateProjectionIntervals(a,b,c,d,e,f,o)}}},_c9:function(a,b){for(var c=this.vertArrays(),d=0;d<c.length;++d)b=c[d].updateSquaredSphereRadius(a,b);return b},updateSquaredSphereRadius:function(a,b){if(!this._M)return b;var c=this.showRelated();if("asym"===c)return this._c9(a,b);for(var d=this.structure().assembly(c),e=d.generators(),f=0;f<e.length;++f)for(var g=e[f],h=this._bH(g.chains()),i=0;i<g.matrices().length;++i)for(var j=0;j<h.length;++j)b=h[j].updateSquaredSphereRadius(a,b);return b},draw:function(a,b,c,d){if(this._M){var e=this.shaderForStyleAndPass(b,c,d);if(e){var f=this.showRelated();if("asym"===f)return this._b6(a,e,this.vertArrays(),null);var g=this.structure().assembly(f);return this._dN(a,e,g)}}},colorBy:function(a,b){this._o=!1,b=b||this.structure();for(var c=0;c<this._Q.length;++c)this._Q[c].recolor(a,b)},setOpacity:function(a,b){this._o=!1,b=b||this.structure();for(var c=0;c<this._Q.length;++c)this._Q[c].setOpacity(a,b)}}),c}(),o=N=function(){function b(a,b,c){this._b=a,this._ch=a.createBuffer(),this._A=c||null,this._o=!1,this._cc=null;var d=this._y*b;this._c=c.request(d)}var c=a.vec3;return b.prototype={setColor:function(a,b,c,d,e){var f=a*this._y+this._br;this._c[f+0]=b,this._c[f+1]=c,this._c[f+2]=d,this._c[f+3]=e,this._o=!1},getColor:function(a,b){var c=a*this._y+this._br;return b[0]=this._c[c+0],b[1]=this._c[c+1],b[2]=this._c[c+2],b[3]=this._c[c+3],b},setOpacity:function(a,b){var c=a*this._y+this._br;this._c[c+3]=b,this._o=!1},boundingSphere:function(){return this._cc||(this._cc=this._dT()),this._cc},_dT:function(){var a=this.numVerts();if(0===a)return null;var b,d,e=c.create();for(d=0;a>d;++d)b=d*this._y,e[0]+=this._c[b+0],e[1]+=this._c[b+1],e[2]+=this._c[b+2];c.scale(e,e,1/a);var f=0;for(d=0;a>d;++d){b=d*this._y;var g=e[0]-this._c[b+0],h=e[1]-this._c[b+1],i=e[2]-this._c[b+2];f=Math.max(f,g*g+h*h+i*i)}return new k.Sphere(e,Math.sqrt(f))},destroy:function(){this._b.deleteBuffer(this._ch),this._A.release(this._c)},bindBuffers:function(){this._b.bindBuffer(this._b.ARRAY_BUFFER,this._ch),this._o||(this._b.bufferData(this._b.ARRAY_BUFFER,this._c,this._b.STATIC_DRAW),this._o=!0)},updateSquaredSphereRadius:function(){var a=c.create();return function(b,d,e){var f=this.boundingSphere();if(!f)return d;if(e)return c.transformMat4(a,f.center(),e),Math.max(c.sqrDist(a,b),d);var g=f.radius()*f.radius();return Math.max(c.sqrDist(f.center(),b)+g,d)}}(),updateProjectionIntervals:function(){var a=c.create();return function(b,d,e,f,g,h,i){var j=this.boundingSphere();if(j){i?c.transformMat4(a,j.center(),i):c.copy(a,j.center());var k=c.dot(b,a),l=c.dot(d,a),m=c.dot(e,a);f.update(k-j.radius()),f.update(k+j.radius()),g.update(l-j.radius()),g.update(l+j.radius()),h.update(m-j.radius()),h.update(m+j.radius())}}}()},b}(),p=function(){function a(a,b,c){N.call(this,a,b,c),this._bv=0}return e.derive(a,N,{_y:8,_c6:0,_br:3,_d5:7,numVerts:function(){return 2*this._bv},addLine:function(a,b,c,d,e,f){var g=this._y*this._bv*2;this._c[g++]=a[0],this._c[g++]=a[1],this._c[g++]=a[2],this._c[g++]=b[0],this._c[g++]=b[1],this._c[g++]=b[2],this._c[g++]=b[3],this._c[g++]=e,this._c[g++]=c[0],this._c[g++]=c[1],this._c[g++]=c[2],this._c[g++]=d[0],this._c[g++]=d[1],this._c[g++]=d[2],this._c[g++]=d[3],this._c[g++]=f,this._bv+=1,this._o=!1,this._eg=null},bindAttribs:function(a){this._b.vertexAttribPointer(a.posAttrib,3,this._b.FLOAT,!1,4*this._y,4*this._c6),-1!==a.colorAttrib&&(this._b.vertexAttribPointer(a.colorAttrib,4,this._b.FLOAT,!1,4*this._y,4*this._br),this._b.enableVertexAttribArray(a.colorAttrib)),this._b.enableVertexAttribArray(a.posAttrib),-1!==a.objIdAttrib&&(this._b.vertexAttribPointer(a.objIdAttrib,1,this._b.FLOAT,!1,4*this._y,4*this._d5),this._b.enableVertexAttribArray(a.objIdAttrib))},releaseAttribs:function(a){this._b.disableVertexAttribArray(a.posAttrib),-1!==a.colorAttrib&&this._b.disableVertexAttribArray(a.colorAttrib),-1!==a.objIdAttrib&&this._b.disableVertexAttribArray(a.objIdAttrib)},bind:function(a){this.bindBuffers(),this.bindAttribs(a)},draw:function(){this._b.drawArrays(this._b.LINES,0,2*this._bv)}}),a}(),q=O=function(){function a(a,b,c,d,e){N.call(this,a,b,d),this._cI=a.createBuffer(),this._G=e,this._T=0,this._dB=b,this._bh=0,this._E=e.request(c)}return e.derive(a,N,{destroy:function(){N.prototype.destroy.call(this),this._b.deleteBuffer(this._cI),this._G.release(this._E)},setIndexData:function(a){this._o=!1,this._bh=a.length/3;for(var b=0;b<a.length;++b)this._E[b]=a[b]},setVertData:function(a){this._o=!1,this._T=a.length/this._y;for(var b=0;b<a.length;++b)this._c[b]=a[b]},numVerts:function(){return this._T},maxVerts:function(){return this._dB},numIndices:function(){return 3*this._bh},addVertex:function(a,b,c,d){var e=this._T*this._y;this._c[e++]=a[0],this._c[e++]=a[1],this._c[e++]=a[2],this._c[e++]=b[0],this._c[e++]=b[1],this._c[e++]=b[2],this._c[e++]=c[0],this._c[e++]=c[1],this._c[e++]=c[2],this._c[e++]=c[3],this._c[e++]=d,this._T+=1,this._o=!1},_y:11,_d7:44,_eh:10,_d3:40,_br:6,_d6:24,_ei:3,_d4:12,_c6:0,_d2:0,addTriangle:function(a,b,c){var d=3*this._bh;d+2>=this._E.length||(this._E[d++]=a,this._E[d++]=b,this._E[d++]=c,this._bh+=1,this._o=!1)},bindBuffers:function(){var a=this._o,b=this._b;N.prototype.bindBuffers.call(this),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this._cI),a||b.bufferData(b.ELEMENT_ARRAY_BUFFER,this._E,b.STATIC_DRAW)},bindAttribs:function(a){var b=this._b,c=this._d7;b.enableVertexAttribArray(a.posAttrib),b.vertexAttribPointer(a.posAttrib,3,b.FLOAT,!1,c,this._d2),-1!==a.normalAttrib&&(b.enableVertexAttribArray(a.normalAttrib),b.vertexAttribPointer(a.normalAttrib,3,b.FLOAT,!1,c,this._d4)),-1!==a.colorAttrib&&(b.vertexAttribPointer(a.colorAttrib,4,b.FLOAT,!1,c,this._d6),b.enableVertexAttribArray(a.colorAttrib)),-1!==a.objIdAttrib&&(b.vertexAttribPointer(a.objIdAttrib,1,b.FLOAT,!1,c,this._d3),b.enableVertexAttribArray(a.objIdAttrib))},releaseAttribs:function(a){var b=this._b;b.disableVertexAttribArray(a.posAttrib),-1!==a.colorAttrib&&b.disableVertexAttribArray(a.colorAttrib),-1!==a.normalAttrib&&b.disableVertexAttribArray(a.normalAttrib),-1!==a.objIdAttrib&&b.disableVertexAttribArray(a.objIdAttrib)},bind:function(a){this.bindBuffers(),this.bindAttribs(a)},draw:function(){var a=this._b;a.drawElements(a.TRIANGLES,3*this._bh,a.UNSIGNED_SHORT,0)}}),a}(),r=function(a){function b(b,c,d,e){a.call(this,c,d,e),this._I=b}function c(a,b,c,d,e,f){O.call(this,b,c,d,e,f),this._I=a}return e.derive(b,a,{chain:function(){return this._I},drawSymmetryRelated:function(a,b,c){this.bind(b);for(var d=0;d<c.length;++d)a.bind(b,c[d]),this._b.uniform1i(b.symId,d),this.draw();this.releaseAttribs(b)}}),e.derive(c,O,{chain:function(){return this._I}}),c.prototype.drawSymmetryRelated=b.prototype.drawSymmetryRelated,{LineChainData:b,MeshChainData:c}}(p),s=function(a,b){function c(a,b,c){P.call(this,a),this._w=[],this._A=b,this._G=c,this._bg=null,this._4=null}var d=a.MeshChainData;return e.derive(c,P,{_cd:function(a){return Math.min(65536,a)},addChainVertArray:function(a,b,c){this._bg=b,this._4=c;var e=new d(a.name(),this._b,this._cd(b),c,this._A,this._G);return this._w.push(e),e},addVertArray:function(a,c){this._bg=a,this._4=c;var d=new b(this._b,this._cd(a),c,this._A,this._G);return this._w.push(d),d},vertArrayWithSpaceFor:function(a){var c=this._w[this._w.length-1],e=c.maxVerts()-c.numVerts();if(e>=a)return c;this._bg=this._bg-c.numVerts(),this._4=this._4-c.numIndices(),a=this._cd(this._bg);var f=null;return f=c instanceof d?new d(c.chain(),this._b,a,this._4,this._A,this._G):new b(this._b,a,this._4,this._A,this._G),this._w.push(f),f
},vertArray:function(a){return this._w[a]},destroy:function(){P.prototype.destroy.call(this);for(var a=0;a<this._w.length;++a)this._w[a].destroy();this._w=[]},numVerts:function(){return this._w[0].numVerts()},shaderForStyleAndPass:function(a,b,c){if("normal"===c)return a.hemilight;if("select"===c)return a.select;if("outline"===c)return a.outline;var d=a[c];return void 0!==d?d:null},_b6:function(a,b,c,d){var e;if(d)for(e=0;e<c.length;++e)c[e].drawSymmetryRelated(a,b,d);else for(a.bind(b),this._b.uniform1i(b.symId,255),e=0;e<c.length;++e)c[e].bind(b),c[e].draw(),c[e].releaseAttribs(b)},vertArrays:function(){return this._w},addVertex:function(a,b,c,d){var e=this._w[0];e.addVertex(a,b,c,d)},addTriangle:function(a,b,c){var d=this._w[0];d.addTriangle(a,b,c)}}),c}(r,q),t=function(a){function b(a,b){P.call(this,a),this._bb=[],this._A=b,this._cC=1}var c=a.LineChainData;return e.derive(b,P,{addChainVertArray:function(a,b){var d=new c(a.name(),this._b,b,this._A);return this._bb.push(d),d},setLineWidth:function(a){this._cC=a},vertArrays:function(){return this._bb},shaderForStyleAndPass:function(a,b,c){return"outline"===c?null:"select"===c?a.select:a.lines},destroy:function(){P.prototype.destroy.call(this);for(var a=0;a<this._bb.length;++a)this._bb[a].destroy();this._bb=[]},_b6:function(a,b,c,d){this._b.lineWidth(this._cC*a.upsamplingFactor());var e;if(d)for(e=0;e<c.length;++e)c[e].drawSymmetryRelated(a,b,d);else for(this._b.uniform1i(b.symId,255),a.bind(b),e=0;e<c.length;++e)c[e].bind(b),c[e].draw(),c[e].releaseAttribs(b)},vertArray:function(){return this._R}}),b}(r),u=function(){function a(a,b){this._i=a,this._x=[],this._bq=b}function c(a,b,c){this._i=a,this._x=[],this._bq=c,this._bB=b||1,this._bu={}}return a.prototype={addAssoc:function(a,b,c,d){this._x.push({atom:a,vertexArray:b,vertStart:c,vertEnd:d})},recolor:function(a,b){var c=new Float32Array(4*b.atomCount());this._bq&&a.begin(this._i);var d={};b.eachAtom(function(b,e){d[b.index()]=e,a.colorFor(b,c,4*e)}),this._bq&&a.end(this._i);for(var e=0;e<this._x.length;++e){var f=this._x[e],g=d[f.atom.index()];if(void 0!==g)for(var h=c[4*g+0],i=c[4*g+1],j=c[4*g+2],k=c[4*g+3],l=f.vertexArray,m=f.vertStart;m<f.vertEnd;++m)l.setColor(m,h,i,j,k)}},getColorForAtom:function(a,b){for(var c=0;c<this._x.length;++c){var d=this._x[c];if(d.atom.full()===a.full())return d.vertexArray.getColor(d.vertStart,b)}return null},setOpacity:function(a,b){var c={};b.eachAtom(function(a){c[a.index()]=!0});for(var d=0;d<this._x.length;++d){var e=this._x[d],f=c[e.atom.index()];if(f===!0)for(var g=e.vertexArray,h=e.vertStart;h<e.vertEnd;++h)g.setOpacity(h,a)}}},c.prototype={setPerResidueColors:function(a,b){this._bu[a]=b},addAssoc:function(a,b,c,d,e){this._x.push({traceIndex:a,slice:c,vertStart:d,vertEnd:e,vertexArray:b})},recolor:function(a,c){this._bq&&a.begin(this._i);var d,e,f=[],g=this._i.backboneTraces();for(d=0;d<g.length;++d){var h=this._bu[d],i=0,j=g[d];for(e=0;e<j.length();++e)c.containsResidue(j.residueAt(e))?(a.colorFor(j.centralAtomAt(e),h,i),i+=4):i+=4;f.push(this._bB>1?b.interpolateColor(h,this._bB):h)}for(d=0;d<this._x.length;++d){var k=this._x[d],l=k.slice,m=f[k.traceIndex],n=m[4*l],o=m[4*l+1],p=m[4*l+2],q=m[4*l+3],r=k.vertexArray;for(e=k.vertStart;e<k.vertEnd;++e)r.setColor(e,n,o,p,q)}this._bq&&a.end(this._i)},getColorForAtom:function(a,b){var c,d,e=this._i.backboneTraces(),f=a.full().residue();for(c=0;c<e.length;++c){var g=this._bu[c],h=0,i=e[c];for(d=0;d<i.length();++d){if(f===i.residueAt(d).full())return b[0]=g[h+0],b[1]=g[h+1],b[2]=g[h+2],b[3]=g[h+3],b;h+=4}}return null},setOpacity:function(a,c){var d,e,f=[],g=this._i.backboneTraces();for(d=0;d<g.length;++d){var h=this._bu[d],i=0,j=g[d];for(e=0;e<j.length();++e)c.containsResidue(j.residueAt(e))?(h[i+3]=a,i+=4):i+=4;f.push(this._bB>1?b.interpolateColor(h,this._bB):h)}for(d=0;d<this._x.length;++d){var k=this._x[d],l=k.slice,m=f[k.traceIndex],n=m[4*l+3],o=k.vertexArray;for(e=k.vertStart;e<k.vertEnd;++e)o.setOpacity(e,n)}}},{TraceVertexAssoc:c,AtomVertexAssoc:a}}(),v=function(c,d,e,f){function g(a,b,c){for(var d=0;c-1>d;++d)a.addTriangle(b,b+1+d,b+2+d);a.addTriangle(b,b+c,b+1)}function h(a,b,c){for(var d=b+c,e=0;c-1>e;++e)a.addTriangle(d,b+e+1,b+e);a.addTriangle(d,b,b+c-1)}var i=a.vec3,j=a.vec4,l=a.mat3,m=c.TubeProfile,n=c.ProtoSphere,o=c.ProtoCylinder,p=f.TraceVertexAssoc,q=f.AtomVertexAssoc,r=b.interpolateColor,s={},t=.7071,u=[-t,-t,0,t,-t,0,t,t,0,-t,t,0],v=[-6*t,-1*t,0,6*t,-1*t,0,6*t,1*t,0,-6*t,1*t,0],w=[-10*t,-1*t,0,10*t,-1*t,0,10*t,1*t,0,-10*t,1*t,0],x=function(){var a=i.create(),b=i.create(),c=i.create();return function(d,e,f,g){e=Math.max(e,1),f=Math.min(g-1,f);var h=3*(e-1);i.set(a,d[h],d[h+1],d[h+2]),i.set(c,d[3*e],d[3*e+1],d[3*e+2]);for(var j=e;f>j;++j)h=3*(j+1),i.set(b,d[h],d[h+1],d[h+2]),d[3*j+0]=.25*b[0]+.5*c[0]+.25*a[0],d[3*j+1]=.25*b[1]+.5*c[1]+.25*a[1],d[3*j+2]=.25*b[2]+.5*c[2]+.25*a[2],i.copy(a,c),i.copy(c,b)}}(),y=function(){var a=j.fromValues(0,0,0,1);return function(b,c,d,e){var f=e.atomCount(),g=d.idPool.getContinuousRange(f),h=d.protoSphere.numVerts(),i=d.protoSphere.numIndices(),j=1.5*d.radiusMultiplier;b.addIdRange(g),b.addChainVertArray(e,h*f,i*f),e.eachAtom(function(e){var f=b.vertArrayWithSpaceFor(h);d.color.colorFor(e,a,0);var i=f.numVerts(),k=g.nextId({geom:b,atom:e});d.protoSphere.addTransformed(f,e.pos(),j,a,k);var l=f.numVerts();c.addAssoc(e,f,i,l)})}}();s.spheres=function(a,b,c){var e=new n(c.sphereDetail,c.sphereDetail);c.protoSphere=e;var f=new d(b,c.float32Allocator,c.uint16Allocator),g=new q(a,!0);return f.addVertAssoc(g),f.setShowRelated(c.showRelated),c.color.begin(a),a.eachChain(function(a){y(f,g,c,a)}),c.color.end(a),f};var z=function(){var a=i.create(),b=i.create(),c=j.fromValues(0,0,0,1),d=i.create(),e=i.create(),f=l.create();return function(g,h,j,l){var m=l.atomCount(),n=0;l.eachAtom(function(a){n+=a.bonds().length});var o=m*j.protoSphere.numVerts()+n*j.protoCyl.numVerts(),p=m*j.protoSphere.numIndices()+n*j.protoCyl.numIndices();g.addChainVertArray(l,o,p);var q=j.idPool.getContinuousRange(m);g.addIdRange(q),l.eachAtom(function(l){var m=j.protoSphere.numVerts()+l.bondCount()*j.protoCyl.numVerts(),n=g.vertArrayWithSpaceFor(m),o=n.numVerts(),p=q.nextId({geom:g,atom:l});j.color.colorFor(l,c,0),j.protoSphere.addTransformed(n,l.pos(),j.radius,c,p),l.eachBond(function(g){g.mid_point(a),i.sub(b,l.pos(),a);var h=i.length(b);i.scale(b,b,1/h),k.buildRotation(f,b,d,e,!1),i.add(a,a,l.pos()),i.scale(a,a,.5),j.protoCyl.addTransformed(n,a,h,j.radius,f,c,c,p,p)});var r=n.numVerts();h.addAssoc(l,n,o,r)})}}();s.ballsAndSticks=function(a,b,c){var e=new q(a,!0),f=new n(c.sphereDetail,c.sphereDetail),g=new o(c.arcDetail);c.protoSphere=f,c.protoCyl=g;var h=new d(b,c.float32Allocator,c.uint16Allocator);return h.addVertAssoc(e),h.setShowRelated(c.showRelated),c.color.begin(a),a.eachChain(function(a){z(h,e,c,a)}),c.color.end(a),h};var A=function(){var a=i.create(),b=j.fromValues(0,0,0,1);return function(c,d,e,f){var g=0,h=e.atomCount(),i=f.idPool.getContinuousRange(h);c.addIdRange(i),e.eachAtom(function(a){var b=a.bonds().length;g+=b?b:3});var j=c.addChainVertArray(e,2*g);e.eachAtom(function(e){var g=j.numVerts(),h=i.nextId({geom:c,atom:e});if(e.bonds().length)e.eachBond(function(c){c.mid_point(a),f.color.colorFor(e,b,0),j.addLine(e.pos(),b,a,b,h,h)});else{var k=.2,l=e.pos();f.color.colorFor(e,b,0),j.addLine([l[0]-k,l[1],l[2]],b,[l[0]+k,l[1],l[2]],b,h,h),j.addLine([l[0],l[1]-k,l[2]],b,[l[0],l[1]+k,l[2]],b,h,h),j.addLine([l[0],l[1],l[2]-k],b,[l[0],l[1],l[2]+k],b,h,h)}var m=j.numVerts();d.addAssoc(e,j,g,m)})}}();s.lines=function(a,b,c){var d=new q(a,!0);c.color.begin(a);var f=new e(b,c.float32Allocator);return f.setLineWidth(c.lineWidth),f.addVertAssoc(d),f.setShowRelated(c.showRelated),a.eachChain(function(a){A(f,d,a,c)}),c.color.end(a),f};var B=function(a){for(var b=0,c=0;c<a.length;++c)b+=2*(a[c].length()-1);return b},C=function(){var a=j.fromValues(0,0,0,1),b=j.fromValues(0,0,0,1),c=i.create(),d=i.create();return function(e,f,g,h,i,j){f.addAssoc(h,g,0,g.numVerts(),g.numVerts()+1);var k,l=j.float32Allocator.request(4*i.length()),m=j.idPool.getContinuousRange(i.length()),n=m.nextId({geom:e,atom:i.centralAtomAt(0)});e.addIdRange(m);for(var o=1;o<i.length();++o){j.color.colorFor(i.centralAtomAt(o-1),a,0),l[4*(o-1)+0]=a[0],l[4*(o-1)+1]=a[1],l[4*(o-1)+2]=a[2],l[4*(o-1)+3]=a[3],j.color.colorFor(i.centralAtomAt(o),b,0),i.posAt(c,o-1),i.posAt(d,o),k=m.nextId({geom:e,atom:i.centralAtomAt(o)}),g.addLine(c,a,d,b,n,k),n=k,k=null;var p=g.numVerts();f.addAssoc(h,g,o,p-1,p+(o===i.length()-1?0:1))}return l[4*i.length()-4]=b[0],l[4*i.length()-3]=b[1],l[4*i.length()-2]=b[2],l[4*i.length()-1]=b[3],f.setPerResidueColors(h,l),h+1}}(),D=function(a,b,c,d,e){for(var f=e.backboneTraces(),g=B(f),h=a.addChainVertArray(e,g),i=0;i<f.length;++i)d=C(a,b,h,d,f[i],c);return d};s.lineTrace=function(a,b,c){var d=new p(a,1,!0);c.color.begin(a);var f=new e(b,c.float32Allocator);f.setLineWidth(c.lineWidth);var g=0;return a.eachChain(function(a){g=D(f,d,c,g,a)}),f.addVertAssoc(d),f.setShowRelated(c.showRelated),c.color.end(a),f};var E=function(a,b){for(var c=0,d=0;d<a.length;++d)c+=2*(b*(a[d].length()-1)+1);return c},F=function(){var a=i.create(),b=i.create(),c=j.fromValues(0,0,0,1),d=j.fromValues(0,0,0,1);return function(e,f,g,h,i,j){var l,m=j.fullTraceIndex(0),n=h.float32Allocator.request(3*j.length()),o=h.float32Allocator.request(4*j.length()),p=[],q=h.idPool.getContinuousRange(j.length());for(e.addIdRange(q),l=0;l<j.length();++l){var s=j.centralAtomAt(l);j.smoothPosAt(a,l,h.strength),h.color.colorFor(s,o,4*l),n[3*l]=a[0],n[3*l+1]=a[1],n[3*l+2]=a[2],p.push(q.nextId({geom:e,atom:s}))}var t=p[0],u=0,v=k.catmullRomSpline(n,j.length(),h.splineDetail,h.strength,!1,h.float32Allocator),w=r(o,h.splineDetail),x=g.numVerts();f.addAssoc(i,g,m,x,x+1);var y=Math.floor(h.splineDetail/2),z=k.catmullRomSplineNumPoints(j.length(),h.splineDetail,!1);for(l=1;z>l;++l){a[0]=v[3*(l-1)],a[1]=v[3*(l-1)+1],a[2]=v[3*(l-1)+2],b[0]=v[3*(l-0)],b[1]=v[3*(l-0)+1],b[2]=v[3*(l-0)+2],c[0]=w[4*(l-1)+0],c[1]=w[4*(l-1)+1],c[2]=w[4*(l-1)+2],c[3]=w[4*(l-1)+3],d[0]=w[4*(l-0)+0],d[1]=w[4*(l-0)+1],d[2]=w[4*(l-0)+2],d[3]=w[4*(l-0)+3];var A=Math.floor((l+y)/h.splineDetail);u=p[Math.min(p.length-1,A)],g.addLine(a,c,b,d,t,u),t=u;var B=g.numVerts();f.addAssoc(i,g,m+l,B-1,B+(l===j.length-1?0:1))}return f.setPerResidueColors(i,o),h.float32Allocator.release(n),h.float32Allocator.release(v),i+1}}(),G=function(a,b,c,d,e){for(var f=d.backboneTraces(),g=E(f,c.splineDetail),h=a.addChainVertArray(d,g),i=0;i<f.length;++i)e=F(a,b,h,c,e,f[i]);return e};s.sline=function(a,b,c){c.color.begin(a);var d=new p(a,c.splineDetail,1,!0),f=new e(b,c.float32Allocator);f.addVertAssoc(d),f.setLineWidth(c.lineWidth),f.setShowRelated(c.showRelated);var g=0;return a.eachChain(function(a){g=G(f,d,c,a,g)}),c.color.end(a),f};var H=function(a,b,c){for(var d=0,e=0;e<a.length;++e)d+=a[e].length()*b,d+=(a[e].length()-1)*c;return d},I=function(a,b,c){for(var d=0,e=0;e<a.length;++e)d+=a[e].length()*b,d+=(a[e].length()-1)*c;return d},J=function(a,b,c,d,e){var f=e.backboneTraces(),g=H(f,c.protoSphere.numVerts(),c.protoCyl.numVerts()),h=I(f,c.protoSphere.numIndices(),c.protoCyl.numIndices());a.addChainVertArray(e,g,h);for(var i=0;i<f.length;++i)R(a,b,f[i],d,c),d++;return d};s.trace=function(a,b,c){c.protoCyl=new o(c.arcDetail),c.protoSphere=new n(c.sphereDetail,c.sphereDetail);var e=new d(b,c.float32Allocator,c.uint16Allocator),f=new p(a,1,!0);e.addVertAssoc(f),e.setShowRelated(c.showRelated),c.color.begin(a);var g=0;return a.eachChain(function(a){g=J(e,f,c,g,a)}),c.color.end(a),e};var K=function(a,b,c){for(var d=0,e=0;e<a.length;++e)d+=((a[e].length()-1)*c+1)*b,d+=2;return d},L=function(a,b,c){for(var d=0,e=0;e<a.length;++e)d+=(a[e].length()*c-1)*b*6,d+=6*b;return d},M=function(){var a=l.create(),b=i.create(),c=i.create(),d=i.create(),e=i.create(),f=j.create();return function(g,h,j,l){for(var m=1.8*l.radius,n=0;n<j.length;++n)for(var o=j[n],p=l.idPool.getContinuousRange(o.length()),q=0;q<o.length();++q){var r=l.protoCyl.numVerts(),s=g.vertArrayWithSpaceFor(r),t=s.numVerts(),u=o.residueAt(q),v=u.name(),w=u.atom("C3'"),x=null;if(x=u.atom("A"===v||"G"===v||"DA"===v||"DG"===v?"N1":"N3"),null!==x&&null!==w){var y=p.nextId({geom:g,atom:x});i.add(e,w.pos(),x.pos()),i.scale(e,e,.5),l.color.colorFor(x,f,0),i.sub(d,x.pos(),w.pos());var z=i.length(d);i.scale(d,d,1/z),k.buildRotation(a,d,c,b,!1),l.protoCyl.addTransformed(s,e,z,m,a,f,f,y,y),l.protoSphere.addTransformed(s,x.pos(),m,f,y),l.protoSphere.addTransformed(s,w.pos(),m,f,y);var A=s.numVerts();h.addAssoc(x,s,t,A)}}}}(),N=function(a,b,c,d,e,f){for(var g=f.backboneTraces(),h=K(g,4*d.arcDetail,d.splineDetail),i=L(g,4*d.arcDetail,d.splineDetail),j=[],k=d.protoCyl.numVerts()+2*d.protoSphere.numVerts(),l=d.protoCyl.numIndices()+2*d.protoSphere.numIndices(),m=0;m<g.length;++m){var n=g[m];n.residueAt(0).isNucleotide()&&(j.push(n),h+=n.length()*k,i+=n.length()*l)}a.addChainVertArray(f,h,i);for(var o=0;o<g.length;++o)Q(a,b,g[o],e,d),e++;return M(a,c,j,d),e};s.cartoon=function(a,b,c){c.arrowSkip=Math.floor(3*c.splineDetail/4),c.coilProfile=new m(u,c.arcDetail,1),c.helixProfile=new m(v,c.arcDetail,.1),c.strandProfile=new m(v,c.arcDetail,.1),c.arrowProfile=new m(w,c.arcDetail,.1),c.protoCyl=new o(4*c.arcDetail),c.protoSphere=new n(4*c.arcDetail,4*c.arcDetail);var e=new d(b,c.float32Allocator,c.uint16Allocator),f=new p(a,c.splineDetail,!0);e.addVertAssoc(f),e.setShowRelated(c.showRelated),c.color.begin(a);var g=0,h=a.select({anames:["N1","N3"]}),i=new q(h,!0);return e.addVertAssoc(i),a.eachChain(function(a){g=N(e,f,i,c,g,a)}),c.color.end(a),e},s.surface=function(){var a=i.create(),b=i.create(),c=j.fromValues(.8,.8,.8,1);return function(e,f,g){var h=0;e.getUint32(0),h+=4;var j=e.getUint32(h);h+=4;var k=24,l=k*j+h,m=e.getUint32(l),n=new d(f,g.float32Allocator,g.uint16Allocator);n.setShowRelated("asym");var o,p=n.addVertArray(j,3*m);for(o=0;j>o;++o)i.set(a,e.getFloat32(h+0),e.getFloat32(h+4),e.getFloat32(h+8)),h+=12,i.set(b,e.getFloat32(h+0),e.getFloat32(h+4),e.getFloat32(h+8)),h+=12,p.addVertex(a,b,c,0);for(h=l+4,o=0;m>o;++o){var q=e.getUint32(h+0),r=e.getUint32(h+4),s=e.getUint32(h+8);h+=12,p.addTriangle(q-1,s-1,r-1)}return n}}();var O=function(){var a=l.create(),b=i.create();return function(c,d,e,f,g,h,j,l,m,n,o){var p=m.coilProfile;"C"===f||m.forceTube?l?k.ortho(e,g):i.cross(e,b,g):"H"===f?p=m.helixProfile:"E"===f?p=m.strandProfile:"A"===f&&(p=m.arrowProfile),k.buildRotation(a,g,e,b,!0),p.addTransformed(c,d,j,a,h,l,n,o)}}(),P=function(){var a=i.create(),b=i.create(),c=i.create();return function(d,e,f,g,h,j,k,l){var m=null,n=null,o=e.length();i.set(c,0,0,0);for(var p=0;o>p;++p){j.push(k.nextId({geom:d,atom:e.centralAtomAt(p)})),e.smoothPosAt(a,p,l.strength),g[3*p]=a[0],g[3*p+1]=a[1],g[3*p+2]=a[2],e.smoothNormalAt(b,p,l.strength);var q=e.centralAtomAt(p);l.color.colorFor(q,f,4*p),i.dot(b,c)<0&&i.scale(b,b,-1),"E"!==e.residueAt(p).ss()||l.forceTube||(null===m&&(m=p),n=p),"C"===e.residueAt(p).ss()&&null!==m&&(x(g,m,n,o),x(h,m,n,o),m=null,n=null),h[3*p]=g[3*p]+b[0]+c[0],h[3*p+1]=g[3*p+1]+b[1]+c[1],h[3*p+2]=g[3*p+2]+b[2]+c[2],i.copy(c,b)}}}(),Q=function(){var a=i.create(),b=i.create(),c=j.fromValues(0,0,0,1),d=i.create(),e=i.create();return function(f,l,m,n,o){var p=K([m],4*o.arcDetail,o.splineDetail),q=o.float32Allocator.request(3*m.length()),s=o.float32Allocator.request(4*m.length()),t=o.float32Allocator.request(3*m.length()),u=[],v=o.idPool.getContinuousRange(m.length());P(f,m,s,q,t,u,v,o),f.addIdRange(v);var w=f.vertArrayWithSpaceFor(p),x=k.catmullRomSpline(q,m.length(),o.splineDetail,o.strength,!1,o.float32Allocator),y=k.catmullRomSpline(t,m.length(),o.splineDetail,o.strength,!1,o.float32Allocator);l.setPerResidueColors(n,s);var z=o.radius*(m.residueAt(0).isAminoacid()?1:1.8),A=r(s,o.splineDetail);i.set(a,x[3]-x[0],x[4]-x[1],x[5]-x[2]),i.set(b,x[0],x[1],x[2]),i.set(d,y[0]-x[0],y[1]-x[0],y[2]-x[2]),i.normalize(a,a),i.normalize(d,d),j.set(c,A[0],A[1],A[2],A[3]);var B=w.numVerts();w.addVertex(b,[-a[0],-a[1],-a[2]],c,u[0]),O(w,b,d,m.residueAt(0).ss(),a,c,z,!0,o,0,u[0]),g(w,B,4*o.arcDetail);var C=w.numVerts(),D=0;l.addAssoc(n,w,D,B,C),D+=1;for(var E=Math.floor(o.splineDetail/2),F=k.catmullRomSplineNumPoints(m.length(),o.splineDetail,!1),G=1,H=F;H>G;++G){var I=3*G,J=4*G,L=3*(G+1),M=3*(G-1);i.set(b,x[I],x[I+1],x[I+2]),G===H-1?i.set(a,x[I]-x[M],x[I+1]-x[M+1],x[I+2]-x[M+2]):i.set(a,x[L]-x[M],x[L+1]-x[M+1],x[L+2]-x[M+2]),i.normalize(a,a),j.set(c,A[J],A[J+1],A[J+2],A[J+3]);var N=0,Q=Math.floor(G/o.splineDetail),R=Math.floor((G-1)/o.splineDetail),S=Math.floor((G+o.arrowSkip)/o.splineDetail),T=!1,U=m.residueAt(Q).ss();if(!o.forceTube){if(Q!==R){var V=m.residueAt(R).ss();if("C"===V&&("H"===U||"E"===U)){i.set(e,y[M]-x[M],y[M+1]-x[M+1],y[M+2]-x[M+2]),i.normalize(e,e);var W=2*Math.PI/(4*o.arcDetail),X=k.signedAngle(d,e,a);N=Math.round(X/W),N=(N+4*o.arcDetail)%(4*o.arcDetail)}}if(S!==Q&&S<m.length()){var Y=m.residueAt(S).ss();"C"===Y&&"E"===U&&(T=!0)}}i.set(d,y[3*G]-x[I],y[I+1]-x[I+1],y[I+2]-x[I+2]),i.normalize(d,d),B=w.numVerts();var Z=Math.floor((G+E)/o.splineDetail),$=u[Math.min(u.length-1,Z)];O(w,b,d,U,a,c,z,!1,o,N,$),T&&(l.addAssoc(n,w,D,B,C),O(w,b,d,"A",a,c,z,!1,o,0,$),G+=o.arrowSkip),C=w.numVerts(),G===H-1&&(C+=1),l.addAssoc(n,w,D,B,C),D+=1,T&&(D+=o.arrowSkip)}w.addVertex(b,a,c,u[u.length-1]),h(w,B,4*o.arcDetail),o.float32Allocator.release(t),o.float32Allocator.release(q)}}(),R=function(){var a=l.create(),b=i.create(),c=i.create(),d=i.create(),e=i.create(),f=i.create(),g=i.create(),h=j.fromValues(0,0,0,1),m=j.fromValues(0,0,0,1);return function(j,l,n,o,p){if(0!==n.length()){var q=p.idPool.getContinuousRange(n.length());j.addIdRange(q),p.color.colorFor(n.centralAtomAt(0),h,0);var r=H([n],p.protoSphere.numVerts(),p.protoCyl.numVerts()),s=r,t=j.vertArrayWithSpaceFor(r),u=t.maxVerts(),v=t.numVerts();n.posAt(f,0);var w=q.nextId({geom:j,atom:n.centralAtomAt(0)}),x=0;p.protoSphere.addTransformed(t,f,p.radius,h,w);var y=null;l.addAssoc(o,t,0,v,y);var z=p.float32Allocator.request(4*n.length());z[0]=h[0],z[1]=h[1],z[2]=h[2],z[3]=h[3];for(var A=p.protoCyl.numVerts()+p.protoSphere.numVerts(),B=1;B<n.length();++B){x=q.nextId({geom:j,atom:n.centralAtomAt(B)}),n.posAt(f,B-1),n.posAt(g,B),p.color.colorFor(n.centralAtomAt(B),m,0),z[4*B+0]=m[0],z[4*B+1]=m[1],z[4*B+2]=m[2],z[4*B+3]=m[3],i.sub(b,g,f);var C=i.length(b);i.scale(b,b,1/C),k.buildRotation(a,b,c,d,!1),i.copy(e,f),i.add(e,e,g),i.scale(e,e,.5),A>u-t.numVerts()&&(t=j.vertArrayWithSpaceFor(s)),s-=A;var D=t.numVerts();p.protoCyl.addTransformed(t,e,C,p.radius,a,h,m,w,x),y=t.numVerts(),y-=(y-D)/2,p.protoSphere.addTransformed(t,g,p.radius,m,x),w=x,l.addAssoc(o,t,B,v,y),v=y,i.copy(h,m)}l.setPerResidueColors(o,z),l.addAssoc(o,t,n.length()-1,v,t.numVerts())}}}();return s}(l,s,t,u),w=function(){function a(a,b,c,d,e,f){M.call(this,a);var g=f||{};this._={},this._.fillStyle=g.fillStyle||"#000",this._.backgroundAlpha=g.backgroundAlpha||0,this._.fontSize=g.fontSize||24,this._.font=g.font||"Verdana",this._.fontStyle=g.fontStyle||"normal",this._.fontColor=g.fontColor||"#000",this._bR=100,this._cu=d,this._dD=this._b.createBuffer(),this._f=new Float32Array(30),this._dp(b,c,e);var h=.5,i=.5;this._f[0]=d[0],this._f[1]=d[1],this._f[2]=d[2],this._f[3]=-h,this._f[4]=-i,this._f[5]=d[0],this._f[6]=d[1],this._f[7]=d[2],this._f[8]=h,this._f[9]=i,this._f[10]=d[0],this._f[11]=d[1],this._f[12]=d[2],this._f[13]=h,this._f[14]=-i,this._f[15]=d[0],this._f[16]=d[1],this._f[17]=d[2],this._f[18]=-h,this._f[19]=-i,this._f[20]=d[0],this._f[21]=d[1],this._f[22]=d[2],this._f[23]=-h,this._f[24]=i,this._f[25]=d[0],this._f[26]=d[1],this._f[27]=d[2],this._f[28]=h,this._f[29]=i}function b(a){for(var b=1;a>b;)b*=2;return b}return e.derive(a,M,{updateProjectionIntervals:function(){},updateSquaredSphereRadius:function(a,b){return b},_cq:function(a){a.fillStyle=this._.fontColor,a.textAlign="left",a.textBaseline="bottom",a.font=this._.fontStyle+" "+this._.fontSize+"px "+this._.font},_dp:function(a,c,d){this._cq(c);var e=c.measureText(d).width,f=24;a.width=b(e),a.height=b(f),c.fillStyle=this._.fillStyle,c.globalAlpha=this._.backgroundAlpha,c.fillRect(0,0,a.width,a.height),this._cq(c),c.globalAlpha=1,c.lineWidth=.5,c.lineStyle="none",c.fillText(d,0,a.height),c.strokeText(d,0,a.height),this._cm=this._b.createTexture(),this._df(this._cm,a),this._c8=e/a.width,this._c7=f/a.height,this._q=e,this._r=f},_df:function(a,b){var c=this._b;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,!0),c.bindTexture(c.TEXTURE_2D,a),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,b),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.generateMipmap(c.TEXTURE_2D),c.bindTexture(c.TEXTURE_2D,null)},bind:function(){var a=this._b;a.bindBuffer(a.ARRAY_BUFFER,this._dD),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,this._cm),this._o||(a.bufferData(a.ARRAY_BUFFER,this._f,a.STATIC_DRAW),this._o=!0)},draw:function(a,b,c,d){if(this._M&&"normal"===d){var e=b.text;a.bind(e),this.bind();var f=this._b,g=a.upsamplingFactor();f.uniform1f(f.getUniformLocation(e,"xScale"),this._c8),f.uniform1f(f.getUniformLocation(e,"yScale"),this._c7),f.uniform1f(f.getUniformLocation(e,"width"),2*g*this._q/a.viewportWidth()),f.uniform1f(f.getUniformLocation(e,"height"),2*g*this._r/a.viewportHeight()),f.uniform1i(f.getUniformLocation(e,"sampler"),0);var h=f.getAttribLocation(e,"attrCenter");f.enableVertexAttribArray(h),f.vertexAttribPointer(h,3,f.FLOAT,!1,20,0);var i=f.getAttribLocation(e,"attrCorner");f.vertexAttribPointer(i,2,f.FLOAT,!1,20,12),f.enableVertexAttribArray(i),f.enable(f.BLEND),f.blendFunc(f.SRC_ALPHA,f.ONE_MINUS_SRC_ALPHA),f.drawArrays(f.TRIANGLES,0,6),f.disableVertexAttribArray(h),f.disableVertexAttribArray(i),f.disable(f.BLEND)}}}),a}(),x=function(c){function d(){this._c=[],this._E=[],this._T=0}function f(a,b,e,f){M.call(this,b),this._A=e,this._G=f,this._B=new d,this._dm=new c.ProtoSphere(8,8),this._dn=new c.ProtoCylinder(8),this._R=null,this._o=!1}function g(a,b,c){for(var d=0;c-1>d;++d)a.addTriangle(b,b+1+d,b+2+d);a.addTriangle(b,b+c,b+1)}function h(a,b,c){for(var d=b+c,e=0;c-1>e;++e)a.addTriangle(d,b+e+1,b+e);a.addTriangle(d,b,b+c-1)}var i=a.vec3,j=a.mat3,l=b.forceRGB;return d.prototype={numVerts:function(){return this._T},addVertex:function(a,b,c,d){this._T+=1,this._c.push(a[0],a[1],a[2],b[0],b[1],b[2],c[0],c[1],c[2],c[3],d)},addTriangle:function(a,b,c){this._E.push(a,b,c)},numIndices:function(){return this._E.length},indexData:function(){return this._E},vertData:function(){return this._c}},e.derive(f,M,{updateProjectionIntervals:function(){},updateSquaredSphereRadius:function(a,b){return b},addTube:function(){var a=i.create(),b=i.create(),c=i.create(),d=i.create(),e=j.create();return function(f,j,m,n){n=n||{};var o=l(n.color||"white"),p=!0;void 0!==n.cap&&(p=n.cap),i.sub(d,j,f);var q=i.length(d);if(i.normalize(d,d),i.add(a,f,j),i.scale(a,a,.5),k.buildRotation(e,d,b,c,!1),p){var r=this._B.numVerts();this._B.addVertex(f,[-d[0],-d[1],-d[2]],o,0),g(this._B,r,8)}if(this._dn.addTransformed(this._B,a,q,m,e,o,o,0,0),p){var s=this._B.numVerts();this._B.addVertex(j,d,o,0),h(this._B,s-8,8)}this._o=!1}}(),addSphere:function(a,b,c){c=c||{};var d=l(c.color||"white");this._dm.addTransformed(this._B,a,b,d,0),this._o=!1},_do:function(){this._o=!0,null!==this._R&&this._R.destroy(),this._R=new O(this._b,this._B.numVerts(),this._B.numIndices(),this._A,this._G),this._R.setIndexData(this._B.indexData()),this._R.setVertData(this._B.vertData())},draw:function(a,b,c,d){if(this._M){this._o||this._do();var e=this.shaderForStyleAndPass(b,c,d);if(e){a.bind(e),this._b.uniform1i(e.symId,255);var f=this._R;f.bind(e),f.draw(),f.releaseAttribs(e)}}},shaderForStyleAndPass:function(a,b,c){if("normal"===c)return a.hemilight;if("select"===c)return null;if("outline"===c)return a.outline;var d=a[c];return void 0!==d?d:null}}),f}(l),y=function(){function b(a,b,c){this._bj=a,this._bI=b,this._8=c,this._ec=c,this._be=Date.now(),this._cB=!1,this._cR=!1}function c(a,c,d){b.call(this,h.clone(a),h.clone(c),d),this._u=h.clone(a)}function d(a,c,d){var e=j.create(),f=j.create();j.fromMat4(e,a),j.fromMat4(f,c);var g=i.create(),h=i.create();i.fromMat3(g,e),i.fromMat3(h,f),this._u=j.create(),b.call(this,g,h,d)}function f(a,c,d){var e=j.create();j.fromMat4(e,a),b.call(this,e,null,d),this._cf=h.clone(c),this.setLooping(!0),this._u=j.create()}function g(a,c,d){var e=j.create();j.fromMat4(e,a);var f=1e3*(2*Math.PI/d);b.call(this,e,null,f),this._cf=h.clone(c),this.setLooping(!0),this._ea=d,this._u=j.create()}var h=a.vec3,i=a.quat,j=a.mat3;return b.prototype={setLooping:function(a){this._cB=a},step:function(){var a,b=Date.now(),c=b-this._be;if(0===this._8)a=1;else if(this._cB){var d=Math.floor(c/this._8);a=(c-d*this._8)/this._8}else c=Math.min(this._8,c),a=c/this._8,this._cR=1===a;return this._bf(a)},_bf:function(a){var b=(1-Math.cos(a*Math.PI))/2;return this._u=this._bj*(1-b)+this._bI*b,this._u},finished:function(){return this._cR}},e.derive(c,b,{_bf:function(a){var b=(1-Math.cos(a*Math.PI))/2;return h.lerp(this._u,this._bj,this._bI,b),this._u}}),e.derive(d,b,{_bf:function(){var a=i.create();return function(b){return i.slerp(a,this._bj,this._bI,b),j.fromQuat(this._u,a),this._u}}()}),e.derive(f,b,{_bf:function(){var a=j.create();return function(b){var c=.2*Math.sin(2*b*Math.PI);return k.axisRotation(a,this._cf,c),j.mul(this._u,this._bj,a),this._u}}()}),e.derive(g,b,{_bf:function(){var a=j.create();return function(b){var c=2*Math.PI*b;return k.axisRotation(a,this._cf,c),j.mul(this._u,a,this._bj,a),this._u}}()}),{Move:c,Rotate:d,RockAndRoll:f,Animation:b,Spin:g}}(),z=function(d,f,g,h,i,j,k,l,m,n){function o(){return/(iPad|iPhone|iPod)/g.test(navigator.userAgent)}function p(a){if("complete"!==document.readyState&&"loaded"!==document.readyState&&"interactive"!==document.readyState)return!1;if(void 0===a)try{var b=document.createElement("canvas");return!(!window.WebGLRenderingContext||!b.getContext("experimental-webgl"))}catch(c){return!1}return!!a}function q(a,b){return a=a||"auto","fixed"===a?new c.FixedSlab(b):"auto"===a?new c.AutoSlab(b):null}function r(a,b,c){this._ds=a,this._dh=b,this._dc=c}function s(a,b){this._=this._dG(b,a),this._bC=!1,this._k=[],this._0=a,this._bO=!1,this._bN=!1,this._ed=null,this._cw=new d,this.listenerMap={},this._n={center:null,zoom:null,rotation:null},this._dK(),this.quality(this._.quality),null!==this._.atomDoubleClicked&&this.addListener("atomDoubleClicked",this._.atomDoubleClicked),null!==this._.atomClick&&this.addListener("atomClicked",this._.atomClick),"complete"===document.readyState||"loaded"===document.readyState||"interactive"===document.readyState?this._cG():document.addEventListener("DOMContentLoaded",e.bind(this,this._cG))}function t(a,b,c){return b in a?a[b]:c}var u='<div style="vertical-align:middle; text-align:center;"><h1>WebGL not supported</h1><p>Your browser does not support WebGL. You might want to try Chrome, Firefox, IE 11, or newer versions of Safari</p><p>If you are using a recent version of one of the above browsers, your graphic card might be blocked. Check the browser documentation for details on how to unblock it.</p></div>',v=a.vec3,w=a.mat4,x=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}();return r.prototype={object:function(){return this._ds},symIndex:function(){return this._dh},transform:function(){return this._dc}},s.prototype={_dG:function(a,c){a=a||{};var d={width:a.width||500,height:a.height||500,animateTime:a.animateTime||0,antialias:a.antialias,quality:t(a,"quality","low"),style:t(a,"style","hemilight"),background:b.forceRGB(a.background||"white"),slabMode:q(a.slabMode),atomClick:a.atomClicked||a.atomClick||null,outline:t(a,"outline",!0),atomDoubleClicked:t(a,"atomDoubleClicked",t(a,"atomDoubleClick","center")),fog:t(a,"fog",!0)},e=c.getBoundingClientRect();return"auto"===d.width&&(d.width=e.width),"auto"===d.height&&(d.height=e.height),d},_dS:function(a){if(null!==a){var b=v.create(),c=a.object().atom,d=c.pos();a.transform()?(v.transformMat4(b,d,a.transform()),this.setCenter(b,this._.animateTime)):this.setCenter(d,this._.animateTime)}},_dL:function(){if(this._bN){this._bN=!1;var a=this._.width*this._.samples,b=this._.height*this._.samples;this._.realWidth=a,this._.realHeight=b,this._b.viewport(0,0,a,b),this._h.width=a,this._h.height=b,this._d.setViewportSize(a,b),this._.samples>1&&this._cH(this._.samples),this._bQ.resize(this._.width,this._.height)}},resize:function(a,b){(a!==this._.width||b!==this._.height)&&(this._bN=!0,this._.width=a,this._.height=b,this.requestRedraw())},fitParent:function(){var a=this._0.getBoundingClientRect();this.resize(a.width,a.height)},gl:function(){return this._b},ok:function(){return this._bC},options:function(a,b){return void 0!==b?("fog"===a?(this._d.fog(b),this._.fog=b,this.requestRedraw()):this._[a]=b,b):this._[a]},quality:function(a){return this._.quality=a,"high"===a?(this._.arcDetail=4,this._.sphereDetail=16,void(this._.splineDetail=8)):"medium"===a?(this._.arcDetail=3,this._.sphereDetail=10,void(this._.splineDetail=4)):"low"===a?(this._.arcDetail=2,this._.sphereDetail=8,void(this._.splineDetail=2)):void 0},imageData:function(){return this._h.toDataURL()},_dI:function(){try{var a={antialias:this._.antialias,preserveDrawingBuffer:!0};this._b=this._h.getContext("experimental-webgl",a)}catch(b){return!1}return this._b?!0:!1},_cH:function(a){var b=1/a,c=.5*-(1-b)*this._.realWidth,d=.5*-(1-b)*this._.realHeight,e="translate("+c+"px, "+d+"px)",f="scale("+b+", "+b+")",g=e+" "+f;this._h.style.webkitTransform=g,this._h.style.transform=g,this._h.style.ieTransform=g,this._h.width=this._.realWidth,this._h.height=this._.realHeight
},_dF:function(){var a={width:this._.width,height:this._.height};this._bQ=new f(this._b,a)},_dH:function(){var a=1;if(!this._dI())return!1;var b=this._b;return!b.getContextAttributes().antialias&&this._.antialias&&(a=2),this._.realWidth=this._.width*a,this._.realHeight=this._.height*a,this._.samples=a,a>1&&this._cH(a),b.viewportWidth=this._.realWidth,b.viewportHeight=this._.realHeight,b.clearColor(this._.background[0],this._.background[1],this._.background[2],1),b.lineWidth(2),b.cullFace(b.FRONT),b.enable(b.CULL_FACE),b.enable(b.DEPTH_TEST),this._dF(),!0},_cp:function(a,b){var c,d=this._b;if("fragment"===b)c=d.createShader(d.FRAGMENT_SHADER);else{if("vertex"!==b)return null;c=d.createShader(d.VERTEX_SHADER)}var e=o()?"highp":"mediump",f=a.replace("${PRECISION}",e);return d.shaderSource(c,f),d.compileShader(c),d.getShaderParameter(c,d.COMPILE_STATUS)?c:null},_bi:function(a,b){var c=this._b,d=this._cp(b,"fragment"),f=this._cp(a,"vertex"),g=c.createProgram();if(c.attachShader(g,f),c.attachShader(g,d),c.linkProgram(g),!c.getProgramParameter(g,c.LINK_STATUS))return null;c.clearColor(this._.background[0],this._.background[1],this._.background[2],1),c.enable(c.BLEND),c.blendFunc(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA),c.enable(c.CULL_FACE),c.enable(c.DEPTH_TEST);var h=e.bind(c,c.getAttribLocation),i=e.bind(c,c.getUniformLocation);return g.posAttrib=h(g,"attrPos"),g.colorAttrib=h(g,"attrColor"),g.normalAttrib=h(g,"attrNormal"),g.objIdAttrib=h(g,"attrObjId"),g.symId=i(g,"symId"),g.projection=i(g,"projectionMat"),g.modelview=i(g,"modelviewMat"),g.rotation=i(g,"rotationMat"),g.fog=i(g,"fog"),g.fogFar=i(g,"fogFar"),g.fogNear=i(g,"fogNear"),g.fogColor=i(g,"fogColor"),g.outlineColor=i(g,"outlineColor"),g},_dw:function(){var a=this._h;a.removeEventListener("mousemove",this._by,!1),a.removeEventListener("mousemove",this._bz,!1),a.removeEventListener("mouseup",this._bx,!1),document.removeEventListener("mouseup",this._bx,!1),document.removeEventListener("mousemove",this._by),document.removeEventListener("mousemove",this._bz)},_cG:function(){if(!this._dH())return this._0.removeChild(this._h),this._0.innerHTML=u,this._0.style.width=this._.width+"px",this._0.style.height=this._.height+"px",!1;this._d8=this._bt.getContext("2d"),this._A=new g(Float32Array),this._G=new g(Uint16Array),this._d=new h(this._b),this._d.setUpsamplingFactor(this._.samples),this._d.fog(this._.fog),this._d.setFogColor(this._.background),this._di={hemilight:this._bi(i.HEMILIGHT_VS,i.HEMILIGHT_FS),outline:this._bi(i.OUTLINE_VS,i.OUTLINE_FS),lines:this._bi(i.HEMILIGHT_VS,i.LINES_FS),text:this._bi(i.TEXT_VS,i.TEXT_FS),select:this._bi(i.SELECT_VS,i.SELECT_FS)},this._dW=e.bind(this,this._dP),this._bz=e.bind(this,this._dy),this._by=e.bind(this,this._dx),this._bx=e.bind(this,this._dw);var a=e.bind(this._h,this._h.addEventListener);return"onwheel"in this._h?a("wheel",e.bind(this,this._du),!1):a("mousewheel",e.bind(this,this._dv),!1),a("dblclick",e.bind(this,this._cy),!1),a("mousedown",e.bind(this,this._dz),!1),this._d9=new j(this._h,this,this._d),this._bC||(this._bC=!0,this._b7({name:"viewerReadyEvent"},"viewerReady",this)),!0},requestRedraw:function(){this._bO||(this._bO=!0,x(this._dW))},_b5:function(a){for(var b=0,c=this._k.length;b!==c;++b)this._k[b].draw(this._d,this._di,this._.style,a)},_dK:function(){this._h=document.createElement("canvas"),this._bt=document.createElement("canvas"),this._bt.style.display="none",this._h.width=this._.width,this._h.height=this._.height,this._0.appendChild(this._h),this._0.appendChild(this._bt)},setRotation:function(a,b){if(b|=0,0===b)return this._d.setRotation(a),void this.requestRedraw();var c;9===a.length?(c=w.create(),w.fromMat3(c,a)):c=w.clone(a),this._n.rotation=new n.Rotate(this._d.rotation(),c,b),this.requestRedraw()},setCamera:function(a,b,c,d){d|=0,this.setCenter(b,d),this.setRotation(a,d),this.setZoom(c,d)},_d1:function(){var a=!1;this._n.center&&(this._d.setCenter(this._n.center.step()),this._n.center.finished()&&(this._n.center=null),a=!0),this._n.rotation&&(this._d.setRotation(this._n.rotation.step()),this._n.rotation.finished()&&(this._n.rotation=null),a=!0),this._n.zoom&&(this._d.setZoom(this._n.zoom.step()),this._n.zoom.finished()&&(this._n.zoom=null),a=!0),a&&this.requestRedraw()},_dP:function(){this._bO=!1,this._dL(),this._d1();var a=this._.slabMode.update(this._k,this._d);null!==a&&this._d.setNearFar(a.near,a.far),this._b.clear(this._b.COLOR_BUFFER_BIT|this._b.DEPTH_BUFFER_BIT),this._b.viewport(0,0,this._.realWidth,this._.realHeight),this._b.enable(this._b.CULL_FACE),this._.outline&&(this._b.cullFace(this._b.BACK),this._b.enable(this._b.CULL_FACE),this._b5("outline")),this._b.cullFace(this._b.FRONT),this._b.enable(this._b.BLEND),this._b5("normal")},setCenter:function(a,b){return b|=0,0===b?void this._d.setCenter(a):(this._n.center=new n.Move(this._d.center(),v.clone(a),b),void this.requestRedraw())},setZoom:function(a,b){return b|=0,0===b?void this._d.setZoom(a):(this._n.zoom=new n.Animation(this._d.zoom(),a,b),void this.requestRedraw())},centerOn:function(a,b){this.setCenter(a.center(),b)},clear:function(){for(var a=0;a<this._k.length;++a)this._k[a].destroy();this._k=[]},_dv:function(a){this._d.zoom(a.wheelDelta<0?-1:1),a.preventDefault(),this.requestRedraw()},_du:function(a){this._d.zoom(a.deltaY<0?1:-1),a.preventDefault(),this.requestRedraw()},_cy:function(){return function(a){var b=this._h.getBoundingClientRect(),c=this.pick({x:a.clientX-b.left,y:a.clientY-b.top});this._b7(a,"atomDoubleClicked",c),this.requestRedraw()}}(),addListener:function(a,b){var c=this.listenerMap[a];"undefined"==typeof c&&(c=[],this.listenerMap[a]=c),c.push("center"===b?e.bind(this,this._dS):b),this._bC&&"viewerReady"===a&&b(this,null)},_b7:function(a,b,c){var d=this.listenerMap[b];d&&d.forEach(function(b){b(c,a)})},_dz:function(a){if(0===a.button){var b=(new Date).getTime();if("undefined"==typeof this.lastClickTime||b-this.lastClickTime>300){this.lastClickTime=b;var c=this._h.getBoundingClientRect(),d=this.pick({x:a.clientX-c.left,y:a.clientY-c.top});this._b7(a,"atomClicked",d)}a.preventDefault(),a.shiftKey===!0?(this._h.addEventListener("mousemove",this._bz,!1),document.addEventListener("mousemove",this._bz,!1)):(this._h.addEventListener("mousemove",this._by,!1),document.addEventListener("mousemove",this._by,!1)),this._h.addEventListener("mouseup",this._bx,!1),document.addEventListener("mouseup",this._bx,!1),this._6={x:a.pageX,y:a.pageY}}},_dx:function(a){var b={x:a.pageX,y:a.pageY},c={x:b.x-this._6.x,y:b.y-this._6.y},d=.005;this._d.rotateX(d*c.y),this._d.rotateY(d*c.x),this._6=b,this.requestRedraw()},_dy:function(a){var b={x:a.pageX,y:a.pageY},c={x:b.x-this._6.x,y:b.y-this._6.y},d=.001*this._d.zoom();this._d.panXY(d*c.x,d*c.y),this._6=b,this.requestRedraw()},RENDER_MODES:["sline","lines","trace","lineTrace","cartoon","tube","spheres","ballsAndSticks"],renderAs:function(a,b,c,d){for(var e=!1,f=0;f<this.RENDER_MODES.length;++f)if(this.RENDER_MODES[f]===c){e=!0;break}return e?this[c](a,b,d):void 0},_U:function(a,b){return a=this._b2(a),a.showRelated=a.showRelated||"asym",a.showRelated&&"asym"!==a.showRelated&&null===b.assembly(a.showRelated)&&(a.showRelated="asym"),a},_b2:function(a){return a=e.copy(a),a.float32Allocator=this._A,a.uint16Allocator=this._G,a.idPool=this._cw,a},lineTrace:function(a,c,d){var e=this._U(d,c);e.color=e.color||b.uniform([1,0,1]),e.lineWidth=e.lineWidth||4;var f=k.lineTrace(c,this._b,e);return this.add(a,f)},spheres:function(a,c,d){var e=this._U(d,c);e.color=e.color||b.byElement(),e.sphereDetail=this.options("sphereDetail"),e.radiusMultiplier=e.radiusMultiplier||1;var f=k.spheres(c,this._b,e);return this.add(a,f)},sline:function(a,c,d){var e=this._U(d,c);e.color=e.color||b.uniform([1,0,1]),e.splineDetail=e.splineDetail||this.options("splineDetail"),e.strength=e.strength||1,e.lineWidth=e.lineWidth||4;var f=k.sline(c,this._b,e);return this.add(a,f)},cartoon:function(a,c,d){var e=this._U(d,c);e.color=e.color||b.bySS(),e.strength=e.strength||1,e.splineDetail=e.splineDetail||this.options("splineDetail"),e.arcDetail=e.arcDetail||this.options("arcDetail"),e.radius=e.radius||.3,e.forceTube=e.forceTube||!1;var f=k.cartoon(c,this._b,e),g=this.add(a,f);return g},surface:function(a,b,c){var d=this._b2(c),e=k.surface(b,this._b,d);return this.add(a,e)},tube:function(a,b,c){return c=c||{},c.forceTube=!0,this.cartoon(a,b,c)},ballsAndSticks:function(a,c,d){var e=this._U(d,c);e.color=e.color||b.byElement(),e.radius=e.radius||.3,e.arcDetail=2*(e.arcDetail||this.options("arcDetail")),e.sphereDetail=e.sphereDetail||this.options("sphereDetail");var f=k.ballsAndSticks(c,this._b,e);return this.add(a,f)},lines:function(a,c,d){var e=this._U(d,c);e.color=e.color||b.byElement(),e.lineWidth=e.lineWidth||4;var f=k.lines(c,this._b,e);return this.add(a,f)},trace:function(a,c,d){var e=this._U(d,c);e.color=e.color||b.uniform([1,0,0]),e.radius=e.radius||.3,e.arcDetail=2*(e.arcDetail||this.options("arcDetail")),e.sphereDetail=e.sphereDetail||this.options("sphereDetail");var f=k.trace(c,this._b,e);return this.add(a,f)},fitTo:function(a){var b=this._d.mainAxes(),c=[new e.Range,new e.Range,new e.Range];if(a instanceof M)a.updateProjectionIntervals(b[0],b[1],b[2],c[0],c[1],c[2]);else if(void 0!==a.eachAtom){a.eachAtom(function(a){for(var d=a.pos(),e=0;3>e;++e)c[e].update(v.dot(d,b[e]))});for(var d=0;3>d;++d)c[d].extend(1.5)}this._cQ(b,c)},_cQ:function(a,b){if(!(b[0].empty()||b[1].empty()||b[2].empty())){var c=b[0].center(),d=b[1].center(),e=b[2].center(),f=[c*a[0][0]+d*a[1][0]+e*a[2][0],c*a[0][1]+d*a[1][1]+e*a[2][1],c*a[0][2]+d*a[1][2]+e*a[2][2]],g=this._d.fieldOfViewY(),h=this._d.aspectRatio(),i=b[0].length()/h,j=b[1].length(),k=.5*Math.max(i,j),l=k/Math.tan(.5*g),m=l+.5*b[2].length(),n=.5,o=Math.max(l-n,.1),p=2*n+l+b[2].length();this._d.setNearFar(o,p),this.setCamera(this._d.rotation(),f,m,this._.animateTime),this.requestRedraw()}},autoZoom:function(){var a=this._d.mainAxes(),b=[new e.Range,new e.Range,new e.Range];this.forEach(function(c){c.visible()&&c.updateProjectionIntervals(a[0],a[1],a[2],b[0],b[1],b[2])}),this._cQ(a,b)},slabInterval:function(){},autoSlab:function(){var a=this._._eb.update(this._k,this._d);null!==a&&this._d.setNearFar(a.near,a.far),this.requestRedraw()},rockAndRoll:function(a){return a===!0?(this._n.rotation=new n.RockAndRoll(this._d.rotation(),[0,1,0],2e3),this.requestRedraw()):a===!1&&(this._n.rotation=null,this.requestRedraw()),null!==this._n.rotation},spin:function(a,b){return void 0===a||a===!1?(this._n.rotation=null,this.requestRedraw(),!1):(a===!0&&(a=Math.PI/8),b=b||[0,1,0],this._n.rotation=new n.Spin(this._d.rotation(),b,a),this.requestRedraw(),!0)},slabMode:function(a,b){b=b||{};var c=q(a,b),d=c.update(this._k,this._d);null!==d&&this._d.setNearFar(d.near,d.far),this._.slabMode=c,this.requestRedraw()},label:function(a,b,c,d){var e=new l(this._b,this._bt,this._d8,c,b,d);return this.add(a,e),e},customMesh:function(a,b){var c=this._b2(b),d=new m(a,this._b,c.float32Allocator,c.uint16Allocator);return this.add(a,d),d},_dO:function(){var a=this._b;a.clearColor(0,0,0,0),a.disable(a.BLEND),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),a.clearColor(this._.background[0],this._.background[1],this._.background[2],1),a.cullFace(a.FRONT),a.enable(a.CULL_FACE),this._b5("select")},pick:function(a){this._bQ.bind(),this._dO();var b=new Uint8Array(4),c=this._b;if(c.readPixels(a.x,this._.height-a.y,1,1,c.RGBA,c.UNSIGNED_BYTE,b),this._bQ.release(),b.data&&(b=b.data),0===b[3])return null;var d=b[0]|b[1]<<8,e=b[2],f=this._cw.objectForId(d);if(void 0===f)return null;var g=null;return 255!==e&&(g=f.geom.symWithIndex(e)),new r(f,255>e?e:null,g)},add:function(a,b){return b.name(a),this._k.push(b),this._k.sort(function(a,b){return a.order()-b.order()}),this.requestRedraw(),b},_cK:function(a){var b=a.replace(".","\\.").replace("*",".*");return new RegExp("^"+b+"$")},forEach:function(){var a,b="*";2===arguments.length?(a=arguments[1],b=arguments[0]):a=arguments[0];for(var c=this._cK(b),d=0;d<this._k.length;++d){var e=this._k[d];c.test(e.name())&&a(e,d)}},get:function(a){for(var b=0;b<this._k.length;++b)if(this._k[b].name()===a)return this._k[b];return null},hide:function(a){this.forEach(a,function(a){a.hide()})},show:function(a){this.forEach(a,function(a){a.show()})},rm:function(a){for(var b=[],c=this._cK(a),d=0;d<this._k.length;++d){var e=this._k[d];c.test(e.name())?e.destroy():b.push(e)}this._k=b},all:function(){return this._k},isWebGLSupported:function(){return p(this._b)},destroy:function(){this.clear(),this._h.width=1,this._h.height=1,this._h.parentElement.removeChild(this._h),this._h=null}},s.prototype.on=s.prototype.addListener,{Viewer:function(a,b){return new s(a,b)},isWebGLSupported:p}}(d,f,g,h,i,j,v,w,x,y),A=function(){function a(a,b){this._j=a||[],this._bS=b||[]}function b(a){this._D=a,this._b3=[]}return a.prototype={addChain:function(a){this._j.push(a)},chains:function(){return this._j},addMatrix:function(a){this._bS.push(a)},matrices:function(){return this._bS},matrix:function(a){return this._bS[a]}},b.prototype={name:function(){return this._D},generators:function(){return this._b3},generator:function(a){return this._b3[a]},addGenerator:function(a){this._b3.push(a)}},{SymGenerator:a,Assembly:b}}(),B=function(){function a(){}function b(b,c,d,e,f,g,h,i){a.call(this),this._t=b,this._ce=[],this._dC=!!g,this._D=c,this._cu=d,this._bW=f,this._7=e,this._dr=h,this._dg=i}function c(b,c){a.call(this),this._dk=b,this._P=c,this._ce=[]}return a.prototype={name:function(){return this._D},pos:function(){return this._cu},element:function(){return this._7},index:function(){return this._bW},occupancy:function(){return this._dr},tempFactor:function(){return this._dg},prop:function(a){return this[a]()},bondCount:function(){return this.bonds().length},eachBond:function(a){for(var b=this.bonds(),c=0,d=b.length;d>c;++c)a(b[c])}},e.derive(b,a,{addBond:function(a){this._ce.push(a)},name:function(){return this._D},bonds:function(){return this._ce},residue:function(){return this._t},structure:function(){return this._t.structure()},full:function(){return this},qualifiedName:function(){return this.residue().qualifiedName()+"."+this.name()},isHetatm:function(){return this._dC}}),e.derive(c,a,{full:function(){return this._P},name:function(){return this._P.name()},pos:function(){return this._P.pos()},element:function(){return this._P.element()},residue:function(){return this._dk},bonds:function(){return this._P.bonds()},index:function(){return this._P.index()},qualifiedName:function(){return this._P.qualifiedName()},isHetatm:function(){return this._P.isHetatm()}}),{Atom:b,AtomView:c}}(),C=function(b){function c(){}function d(a,b,d,e){c.call(this),this._D=b,this._dt=d,this._dE=e,this._C=[],this._cn="C",this._I=a,this._cE=!1,this._cD=!1,this._bW=a.residues().length}function f(a,b){c.call(this),this._dR=a,this._C=[],this._t=b}var g=a.vec3,h=b.Atom,i=b.AtomView;return c.prototype={prop:function(a){return this[a]()},isWater:function(){return"HOH"===this.name()||"DOD"===this.name()},eachAtom:function(a,b){b|=0;for(var c=0;c<this._C.length;c+=1){if(a(this._C[c],b)===!1)return!1;b+=1}return b},qualifiedName:function(){var a=this.chain().name()+"."+this.name()+this.num();return"\x00"===this.insCode()?a:a+this.insCode()},atom:function(a){if("string"==typeof a){for(var b=0;b<this._C.length;++b)if(this._C[b].name()===a)return this._C[b];return null}return a>=this._C.length&&0>a?null:this._C[a]},centralAtom:function(){return this.isAminoacid()?this.atom("CA"):this.isNucleotide()?this.atom("C3'"):null},center:function(){var a=0,b=g.create();return this.eachAtom(function(c){g.add(b,b,c.pos()),a+=1}),a>0&&g.scale(b,b,1/a),b},isAminoacid:function(){return this._cE},isNucleotide:function(){return this._cD}},e.derive(d,c,{_dQ:function(){this._cD=null!==this.atom("P")&&null!==this.atom("C3'"),this._cE=null!==this.atom("N")&&null!==this.atom("CA")&&null!==this.atom("C")&&null!==this.atom("O")},name:function(){return this._D},insCode:function(){return this._dE},num:function(){return this._dt},full:function(){return this},addAtom:function(a,b,c,d,e,f){var g=new h(this,a,b,c,this.structure().nextAtomIndex(),d,e,f);return this._C.push(g),g},ss:function(){return this._cn},setSS:function(a){this._cn=a},index:function(){return this._bW},atoms:function(){return this._C},chain:function(){return this._I},structure:function(){return this._I.structure()}}),e.derive(f,c,{addAtom:function(a){var b=new i(this,a.full());this._C.push(b)},full:function(){return this._t},num:function(){return this._t.num()},insCode:function(){return this._t.insCode()},ss:function(){return this._t.ss()},index:function(){return this._t.index()},chain:function(){return this._dR},name:function(){return this._t.name()},atoms:function(){return this._C},qualifiedName:function(){return this._t.qualifiedName()},containsResidue:function(a){return this._t.full()===a.full()},isAminoacid:function(){return this._t.isAminoacid()},isNucleotide:function(){return this._t.isNucleotide()},isWater:function(){return this._t.isWater()}}),{ResidueView:f,Residue:d}}(B),D=function(){function b(){this._s=[]}function c(a,b,c,d){this._bD=a,this._V=b,this._cL=c,this._s=d,this._bU=0===this._V,this._bV=this._bD.length()===this._cL;var e=this._cL-this._V;this._bV||++e,this._bU||(++e,this._V-=1),this._bT=e}var d=a.vec3;return b.prototype={push:function(a){this._s.push(a)},length:function(){return this._s.length},residueAt:function(a){return this._s[a]},posAt:function(a,b){return d.copy(a,this._s[b].centralAtom().pos()),a},normalAt:function(a,b){var c=this._s[b];return c.isAminoacid()&&d.sub(a,c.atom("O").pos(),c.atom("C").pos()),d.normalize(a,a),a},centralAtomAt:function(a){return this._s[a].centralAtom()},tangentAt:function(){var a=d.create(),b=d.create();return function(c,e){e>0?this.posAt(a,e-1):this.posAt(a,e),e<this._s.length-1?this.posAt(b,e+1):this.posAt(b,e),d.sub(c,b,a)}}(),fullTraceIndex:function(a){return a},subsets:function(a){for(var b=0,d=0,e=[];d<a.length&&b<this._s.length;){for(var f=a[d].full().index();this._s.length>b&&this._s[b].index()<f;)++b;if(b>=this._s.length)break;for(var g=this._s[b].index();a.length>d&&a[d].full().index()<g;)++d;if(d>=a.length)break;for(var h=b,i=d;a.length>d&&this._s.length>b&&a[d].full().index()===this._s[b].index();)++d,++b;var j=d,k=b;e.push(new c(this,h,k,a.slice(i,j)))}return e}},b.prototype.smoothPosAt=b.prototype.posAt,b.prototype.smoothNormalAt=b.prototype.normalAt,c.prototype={length:function(){return this._bT},residueAt:function(a){return this._bD.residueAt(this._V+a)},_cF:function(){var a=d.create(),b=d.create();return function(c,e,f,g){return this.tangentAt(a,e),this.tangentAt(b,f),d.scale(a,a,g),d.scale(b,b,g),k.cubicHermiteInterpolate(c,this.centralAtomAt(e).pos(),a,this.centralAtomAt(f).pos(),b,.5,0),c}}(),smoothPosAt:function(){return function(a,b,c){if(0===b&&!this._bU)return this._cF(a,b,b+1,c);if(b===this._bT-1&&!this._bV)return this._cF(a,b-1,b,c);var e=this.centralAtomAt(b);return d.copy(a,e.pos()),a}}(),smoothNormalAt:function(){return function(a,b){return this._bD.normalAt(a,b+this._V),a}}(),posAt:function(a,b){var c=this.centralAtomAt(b),e=null;return d.copy(a,c.pos()),0!==b||this._bU||(e=this.centralAtomAt(b+1),d.add(a,a,e.pos()),d.scale(a,a,.5)),b!==this._bT-1||this._bV||(e=this.centralAtomAt(b-1),d.add(a,a,e.pos()),d.scale(a,a,.5)),a},centralAtomAt:function(a){return this.residueAt(a).centralAtom()},fullTraceIndex:function(a){return this._V+a},tangentAt:function(a,b){return this._bD.tangentAt(a,b+this._V)}},{TraceSubset:c,BackboneTrace:b}}(),E=function(b,c){function d(a,b){return a<<8|b.charCodeAt(0)}function f(a,b){return a.num()<b.num()}function g(a){return{num:function(){return a}}}function h(){}function i(a,b){h.call(this),this._i=a,this._D=b,this._ba=[],this._p=[],this._S=!0}function j(a,b,c){var d,e;a?(d=b.atom("C"),e=c.atom("N")):(d=b.atom("O3'"),e=c.atom("P"));var f=n.sqrDist(d.pos(),e.pos());return Math.abs(f-2.25)>1}function k(a,b){b.length()<2||a.push(b)}function l(a,b,c){if(0===a.length)return!0;if(!b)return!1;var e=d(c.num(),c.insCode()),f=a[a.length-1],g=d(f.num(),f.insCode());return e>g}function m(a,b){h.call(this),this._I=b,this._p=[],this._dA=a,this._cr={},this._S=!0}var n=a.vec3,o=b.Residue,p=b.ResidueView;return h.prototype={eachAtom:function(a,b){b|=0;for(var c=0;c<this._p.length;c+=1)if(b=this._p[c].eachAtom(a,b),b===!1)return!1;return b},atomCount:function(){for(var a=0,b=this.residues(),c=0;c<b.length;++c)a+=b[c].atoms().length;return a},eachResidue:function(a){for(var b=0;b<this._p.length;b+=1)if(a(this._p[b])===!1)return!1},residues:function(){return this._p},structure:function(){return this._i},asView:function(){var a=this.structure().createEmptyView();return a.addChain(this,!0),a},residueByRnum:function(a){var b=this.residues();if(this._S){var c=e.binarySearch(b,g(a),f);return-1===c?null:b[c]}for(var d=0;d<b.length;++d)if(b[d].num()===a)return b[d];return null},residuesInRnumRange:function(a,b){var c,d,h=[],i=this.residues();if(this._S===!0){var j=e.indexFirstLargerEqualThan(i,g(a),f);if(-1===j)return h;var k=e.indexLastSmallerEqualThan(i,g(b),f);if(-1===k)return h;for(c=j;k>=c;++c)h.push(this._p[c])}else for(c=0,d=i.length;c!==d;++c){var l=i[c];l.num()>=a&&l.num()<=b&&h.push(l)}return h},prop:function(a){return this[a]()}},e.derive(i,h,{name:function(){return this._D},full:function(){return this},addResidue:function(a,b,c){c=c||"\x00";var d=new o(this,a,b,c);return this._S=l(this._p,this._S,d),this._p.push(d),d},assignSS:function(a,b,c){for(var e=d(a[0],a[1]),f=d(b[0],b[1]),g=1;g<this._p.length-1;++g){var h=this._p[g],i=d(h.num(),h.insCode());e>=i||i>=f||h.setSS(c)}},eachBackboneTrace:function(a){this._dU();for(var b=0;b<this._ba.length;++b)a(this._ba[b])},_dU:function(){if(!(this._ba.length>0)){for(var a=new c.BackboneTrace,b=null,d=0;d<this._p.length;d+=1){var e=this._p[d],f=e.isAminoacid(),g=e.isNucleotide();if(b===!0&&!f||b===!1&&!g||null===b&&!g&&!f)k(this._ba,a),b=null,a=new c.BackboneTrace;else if(0!==a.length()){var h=this._p[d-1];j(b,h,e)&&(k(this._ba,a),a=new c.BackboneTrace),a.push(e)}else a.push(e),b=e.isAminoacid()}k(this._ba,a)}},backboneTraces:function(){var a=[];return this.eachBackboneTrace(function(b){a.push(b)}),a}}),e.derive(m,h,{addResidue:function(a,b){var c=new p(this,a.full());if(this._S=l(this._p,this._S,a),this._p.push(c),this._cr[a.full().index()]=c,b)for(var d=a.atoms(),e=0;e<d.length;++e)c.addAtom(d[e].full());return c},containsResidue:function(a){var b=this._cr[a.full().index()];return void 0===b?!1:b.full()===a.full()},eachBackboneTrace:function(a){for(var b=this._I.backboneTraces(),c=0;c<b.length;++c)for(var d=b[c].subsets(this._p),e=0;e<d.length;++e)a(d[e])},backboneTraces:function(){var a=[];return this.eachBackboneTrace(function(b){a.push(b)}),a},full:function(){return this._I},name:function(){return this._I.name()},structure:function(){return this._dA}}),{Chain:i,ChainView:m}}(C,D),F=function(){var b=a.vec3,c=function(a,c){var d={atom_one:a,atom_two:c};return{atom_one:function(){return d.atom_one},atom_two:function(){return d.atom_two},mid_point:function(a){return a||(a=b.create()),b.add(a,d.atom_one.pos(),d.atom_two.pos()),b.scale(a,a,.5),a}}};return{Bond:c}}(),G=function(){function a(a,b){for(var c=0;c<b.length;++c)if(!b[c](a))return!1;return!0}function b(a){var b=[];return void 0!==a.aname&&b.push(function(b){return b.name()===a.aname}),void 0!==a.hetatm&&b.push(function(b){return b.isHetatm()===a.hetatm}),void 0!==a.anames&&b.push(function(b){for(var c=b.name(),d=0;d<a.anames.length;++d)if(c===a.anames[d])return!0;return!1}),b}function c(a){var b=[];if(void 0!==a.rname&&b.push(function(b){return b.name()===a.rname}),void 0!==a.rnames&&b.push(function(b){for(var c=b.name(),d=0;d<a.rnames.length;++d)if(c===a.rnames[d])return!0;return!1}),void 0!==a.rnums){for(var c={},d=0;d<a.rnums.length;++d)c[a.rnums[d]]=!0;b.push(function(a){var b=a.num();return c[b]===!0})}return void 0!==a.rnum&&b.push(function(b){return b.num()===a.rnum}),b}function d(a){var b=[];return void 0!==a.cname&&(a.chain=a.cname),void 0!==a.cnames&&(a.chains=a.cnames),void 0!==a.chain&&b.push(function(b){return b.name()===a.chain}),void 0!==a.chains&&b.push(function(b){for(var c=b.name(),d=0;d<a.chains.length;++d)if(c===a.chains[d])return!0;return!1}),b}function e(a,b){var c=a.residues();b.rnumRange&&(c=a.residuesInRnumRange(b.rnumRange[0],b.rnumRange[1]));var d,e,f=[];if(void 0!==b.rindexRange){for(d=b.rindexRange[0],e=Math.min(c.length-1,b.rindexRange[1]);e>=d;++d)f.push(c[d]);return f}if(b.rindices&&void 0!==b.rindices.length){for(f=[],d=0;d<b.rindices.length;++d)f.push(c[b.rindices[d]]);return f}return c}function f(f,g,h){var i=c(h),j=b(h),k=d(h);h.rindex&&(h.rindices=[h.rindex]);for(var l=0;l<f._j.length;++l){var m=f._j[l];if(a(m,k))for(var n=e(m,h),o=null,p=0;p<n.length;++p)if(a(n[p],i)){o||(o=g.addChain(m,!1));for(var q=null,r=n[p].atoms(),s=0;s<r.length;++s)a(r[s],j)&&(q||(q=o.addResidue(n[p],!1)),q.addAtom(r[s]))}}return g}return{dict:f}}(),H=function(b,c,d){function f(a){var b=q[a.toUpperCase()];return void 0!==b?b:1.5}function g(a,b,c){var d=b.atom("C"),e=c.atom("N");if(d&&e){var f=m.sqrDist(d.pos(),e.pos());1.6*1.6>f&&a.connect(e,d)}}function h(a,b,c){var d=b.atom("O3'"),e=c.atom("P");if(d&&e){var f=m.sqrDist(d.pos(),e.pos());1.7*1.7>f&&a.connect(d,e)}}function i(){}function j(){i.call(this),this._j=[],this._K=[],this._cx=0}function l(a){i.call(this),this._cz=a,this._j=[]}var m=a.vec3,n=b.Chain,o=b.ChainView,p=c.Bond,q={H:.31,HE:.28,LI:1.28,BE:.96,B:.84,C:.76,N:.71,O:.66,F:.57,NE:.58,NA:1.66,MG:1.41,AL:1.21,SI:1.11,P:1.07,S:1.05,CL:1.02,AR:1.06,K:2.03,CA:1.76,SC:1.7,TI:1.6,V:1.53,CR:1.39,MN:1.39,FE:1.32,CO:1.26,NI:1.24,CU:1.32,ZN:1.22,GA:1.22,GE:1.2,AS:1.19,SE:1.2,BR:1.2,KR:1.16,RB:2.2,SR:1.95,Y:1.9,ZR:1.75,NB:1.64,MO:1.54,TC:1.47,RU:1.46,RH:1.42,PD:1.39,AG:1.45,CD:1.44,IN:1.42,SN:1.39,SB:1.39,TE:1.38,I:1.39,XE:1.4,CS:2.44,BA:2.15,LA:2.07,CE:2.04,PR:2.03,ND:2.01,PM:1.99,SM:1.98,EU:1.98,GD:1.96,TB:1.94,DY:1.92,HO:1.92,ER:1.89,TM:1.9,YB:1.87,LU:1.87,HF:1.75,TA:1.7,W:1.62,RE:1.51,OS:1.44,IR:1.41,PT:1.36,AU:1.36,HG:1.32,TL:1.45,PB:1.46,BI:1.48,PO:1.4,AT:1.5,RN:1.5,FR:2.6,RA:2.21,AC:2.15,TH:2.06,PA:2,U:1.96,NP:1.9,PU:1.87,AM:1.8,CM:1.69};return i.prototype={eachResidue:function(a){for(var b=0;b<this._j.length;b+=1)if(this._j[b].eachResidue(a)===!1)return!1},eachAtom:function(a,b){b|=0;for(var c=0;c<this._j.length;c+=1)if(b=this._j[c].eachAtom(a,b),b===!1)return!1},residueCount:function(){for(var a=this.chains(),b=0,c=0;c<a.length;++c)b+=a[c].residues().length;return b},eachChain:function(a){for(var b=this.chains(),c=0;c<b.length;++c)if(a(b[c])===!1)return},atomCount:function(){for(var a=this.chains(),b=0,c=0;c<a.length;++c)b+=a[c].atomCount();return b},atoms:function(){var a=[];return this.eachAtom(function(b){a.push(b)}),a},atom:function(a){var b=a.split("."),c=this.chain(b[0]);if(null===c)return null;var d=c.residueByRnum(parseInt(b[1],10));return null===d?null:d.atom(b[2])},center:function(){var a=m.create(),b=0;return this.eachAtom(function(c){m.add(a,a,c.pos()),b+=1}),b&&m.scale(a,a,1/b),a},boundingSphere:function(){var a=this.center(),b=0;return this.eachAtom(function(c){b=Math.max(b,m.sqrDist(a,c.pos()))}),new k.Sphere(a,Math.sqrt(b))},backboneTraces:function(){for(var a=this.chains(),b=[],c=0;c<a.length;++c)Array.prototype.push.apply(b,a[c].backboneTraces());return b},select:function(a){return"protein"===a?this.residueSelect(function(a){return a.isAminoacid()}):"water"===a?this.residueSelect(function(a){return a.isWater()}):"ligand"===a?this.residueSelect(function(a){return!a.isAminoacid()&&!a.isWater()}):d.dict(this,new l(this),a||{})},residueSelect:function(a){for(var b=new l(this.full()),c=0;c<this._j.length;++c)for(var d=this._j[c],e=null,f=d.residues(),g=0;g<f.length;++g)a(f[g])&&(e||(e=b.addChain(d,!1)),e.addResidue(f[g],!0));return b},atomSelect:function(a){for(var b=new l(this.full()),c=0;c<this._j.length;++c)for(var d=this._j[c],e=null,f=d.residues(),g=0;g<f.length;++g)for(var h=null,i=f[g],j=i.atoms(),k=0;k<j.length;++k)a(j[k])&&(e||(e=b.addChain(d,!1)),h||(h=e.addResidue(i,!1)),h.addAtom(j[k]));return b},assembly:function(a){for(var b=this.assemblies(),c=0;c<b.length;++c)if(b[c].name()===a)return b[c];return null},chainsByName:function(a){for(var b={},c=this.chains(),d=0;d<c.length;++d)b[c[d].name()]=c[d];for(var e=[],f=0;f<a.length;++f){var g=b[a[f]];void 0!==g&&e.push(g)}return e},selectWithin:function(){var a=m.create();return function(b,c){c=c||{};var d=c.radius||4,e=d*d,f=!!c.matchResidues,g=[];b.eachAtom(function(a){g.push(a)});for(var h=new l(this.full()),i=null,j=null,k=this.chains(),n=!1,o=0;o<k.length;++o){var p=k[o].residues();
j=null;for(var q=0;q<p.length;++q){i=null,n=!1;for(var r=p[q].atoms(),s=0;s<r.length&&!n;++s)for(var t=0;t<g.length;++t)if(m.sub(a,r[s].pos(),g[t].pos()),!(m.sqrLen(a)>e)){if(j||(j=h.addChain(k[o].full(),!1)),i||(i=j.addResidue(p[q].full(),f)),f){n=!0;break}i.addAtom(r[s].full());break}}}return h}}(),createEmptyView:function(){return new l(this.full())}},e.derive(j,i,{addAssembly:function(a){this._K.push(a)},setAssemblies:function(a){this._K=a},assemblies:function(){return this._K},chains:function(){return this._j},full:function(){return this},containsResidue:function(a){return a.full().structure()===this},chainByName:function(a){for(var b=0;b<this._j.length;++b)if(this._j[b].name()===a)return this._j[b];return null},chain:function(a){return this.chainByName(a)},nextAtomIndex:function(){var a=this._cx;return this._cx+=1,a},addChain:function(a){var b=new n(this,a);return this._j.push(b),b},connect:function(a,b){var c=new p(a,b);return a.addBond(c),b.addBond(c),c},deriveConnectivity:function(){var a=this,b=null;this.eachResidue(function(c){for(var d,e=c.atoms(),i=e.length,j=0;i>j;j+=1)for(var k=e[j],l=k.pos(),n=f(k.element()),o=0;j>o;o+=1){var p=e[o],q=f(p.element());d=m.sqrDist(l,p.pos());var r=n+q-.3,s=n+q+.3;s*s>d&&d>r*r&&a.connect(k,p)}c._dQ(),null!==b&&(c.isAminoacid()&&b.isAminoacid()&&g(a,b,c),c.isNucleotide()&&b.isNucleotide()&&h(a,b,c)),b=c})}}),e.derive(l,i,{full:function(){return this._cz},assemblies:function(){return this._cz.assemblies()},addChain:function(a,b){var c=new o(this,a.full());if(this._j.push(c),b)for(var d=a.residues(),e=0;e<d.length;++e)c.addResidue(d[e],!0);return c},containsResidue:function(a){if(!a)return!1;var b=this.chain(a.chain().name());return b?b.containsResidue(a):!1},chains:function(){return this._j},chain:function(a){for(var b=0;b<this._j.length;++b)if(this._j[b].name()===a)return this._j[b];return null}}),{MolView:l,Mol:j}}(E,F,G),I=Q=function(b){function c(a){for(var b=0;b<a.length();++b)a.residueAt(b).setSS(g(a,b)?"H":h(a,b)?"E":"C")}function d(a){for(var b=a.chains(),d=0;d<b.length;++d){var e=b[d];e.eachBackboneTrace(c)}}var e=a.vec3,f=function(){var a=e.create(),b=e.create();return function(c,d,f,g){for(var h=Math.max(0,d-2);d>=h;++h)for(var i=2;5>i;++i)if(!(h+i>=c.length())){var j=e.dist(c.posAt(a,h),c.posAt(b,h+i));if(Math.abs(j-f[i-2])>g)return!1}return!0}}(),g=function(a,b){var c=[5.45,5.18,6.37],d=2.1;return f(a,b,c,d)},h=function(a,b){var c=[6.1,10.4,13],d=1.42;return f(a,b,c,d)};return{Mol:b.Mol,assignHelixSheet:d}}(H),J=function(b){function c(){this._K={},this._u=null}function d(a){if(" "!==a[0]){var b=a.trim();if(4===b.length)for(var c=0,d=b.charCodeAt(c);4>c&&(65>d||d>122||d>90&&97>d);)++c,d=b.charCodeAt(c);return b.substr(0,2)}return a[1]}function e(a){this._b1=[],this._bK=[],this._cb=[],this._bL={},this._i=new Q.Mol,this._ct=new c,this._bG=null,this._bn=null,this._ef=null,this._={},this._.conectRecords=!!a.conectRecords}function f(a){return a.split(/\r\n|\r|\n/g)}function g(a,b){for(var c=b||{},d=f(a),g=new e(c),h=0;h<d.length&&g.processLine(d[h]);h++);var i=g.finish();return i}function h(){this._i=new Q.Mol,this._cs(),this._bM=!1}function i(a){for(var b=new h,c=f(a),d=0;d<c.length&&b.processLine(c[d]);d++);var e=b.finish();return e}function j(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.onload=function(){c.response&&b(c.response)},c.send(null)}function k(a,b,c){j(a,function(a){var d=g(a,c);b(d)})}function l(a,b){j(a,function(a){var c=i(a);b(c)})}var m=a.vec3,n=a.mat4;return c.prototype={assemblies:function(){var a=[];for(var b in this._K)this._K.hasOwnProperty(b)&&a.push(this._K[b]);return a},assembly:function(a){return this._K[a]},nextLine:function(a){if(a=a.substr(11),"B"===a[0]&&"BIOMOLECULE:"===a.substr(0,12)){var c=a.substr(13).trim();return this._cW=new b.Assembly(c),void(this._K[c]=this._cW)}if("APPLY THE FOLLOWING TO CHAINS:"!==a.substr(0,30)&&"                   AND CHAINS:"!==a.substr(0,30)){if("  BIOMT"===a.substr(0,7)){for(var d=parseInt(a[7],10)-1,e=0;" "!==a[12+e];)e+=1;var f=parseFloat(a.substr(13+e,9)),g=parseFloat(a.substr(23+e,9)),h=parseFloat(a.substr(33+e,9)),i=parseFloat(a.substr(43+e,14));return this._9[0+d]=f,this._9[4+d]=g,this._9[8+d]=h,this._9[12+d]=i,void(2===d&&(this._b8.addMatrix(this._9),this._9=n.create()))}}else{var j=a.substr(30).split(",");"A"===a[0]&&(this._b8=new b.SymGenerator,this._cW.addGenerator(this._b8)),this._9=n.create();for(var k=0;k<j.length;++k){var l=j[k].trim();l.length&&this._b8.addChain(l)}}}},e.prototype={parseHelixRecord:function(a){var b=parseInt(a.substr(21,4),10),c=" "===a[25]?"\x00":a[25],d=parseInt(a.substr(33,4),10),e=" "===a[37]?"\x00":a[37],f=a[19];return this._b1.push({first:[b,c],last:[d,e],chainName:f}),!0},parseSheetRecord:function(a){var b=parseInt(a.substr(22,4),10),c=" "===a[26]?"\x00":a[26],d=parseInt(a.substr(33,4),10),e=" "===a[37]?"\x00":a[37],f=a[21];return this._bK.push({first:[b,c],last:[d,e],chainName:f}),!0},parseAndAddAtom:function(a){var b=a[16];if(" "!==b&&"A"!==b)return!0;var c="H"===a[0],e=a[21],f=a.substr(17,3).trim(),g=a.substr(12,4),h=g.trim(),i=parseInt(a.substr(22,4),10);i!==i&&(i=1);var j=" "===a[26]?"\x00":a[26],k=!1,l=!1;this._bG&&this._bG.name()===e||(l=!0,k=!0),this._bn&&this._bn.num()===i&&this._bn.insCode()===j||(k=!0),l&&(this._bG=this._i.chain(e)||this._i.addChain(e)),k&&(this._bn=this._bG.addResidue(f,i,j));for(var n=m.create(),o=0;3>o;++o)n[o]=parseFloat(a.substr(30+8*o,8));var p=a.substr(76,2).trim();""===p&&(p=d(g));var q=a.substr(54,6).trim(),r=a.substr(60,6).trim(),s=this._bn.addAtom(h,n,p,c,q,r);if(this._.conectRecords){var t=parseInt(a.substr(6,5).trim(),10);this._bL[t]=s}return!0},parseConectRecord:function(a){for(var b=parseInt(a.substr(6,5).trim(),10),c=[],d=0;4>d;++d){var e=parseInt(a.substr(11+5*d,6).trim(),10);isNaN(e)||e>b||c.push(e)}return this._cb.push({from:b,to:c}),!0},processLine:function(a){var b=a.substr(0,6);if("ATOM  "===b||"HETATM"===b)return this.parseAndAddAtom(a);if("REMARK"===b){var c=a.substr(7,3);return"350"===c&&this._ct.nextLine(a),!0}return"HELIX "===b?this.parseHelixRecord(a):"SHEET "===b?this.parseSheetRecord(a):this._.conectRecords&&"CONECT"===b?this.parseConectRecord(a):"END   "===b||"ENDMDL"===b?!1:!0},finish:function(){var a,b=null;for(a=0;a<this._bK.length;++a){var c=this._bK[a];b=this._i.chain(c.chainName),b&&b.assignSS(c.first,c.last,"E")}for(a=0;a<this._b1.length;++a){var d=this._b1[a];b=this._i.chain(d.chainName),b&&b.assignSS(d.first,d.last,"H")}return this._i.setAssemblies(this._ct.assemblies()),this._.conectRecords&&this._d0(this._i),this._i.deriveConnectivity(),this._i},_d0:function(a){for(var b=0;b<this._cb.length;++b)for(var c=this._cb[b],d=this._bL[c.from],e=0;e<c.to.length;++e){var f=this._bL[c.to[e]];a.connect(d,f)}}},h.prototype={processLine:function(a){var b=this._3;if(3>b){if(0===b){var c=a.trim();if(0===c.length)return!1;this._cl=c}return this._bM=!1,this._3++,!0}if(3===b){if(this._b4=parseInt(a.substr(0,3).trim(),10),this._cT=parseInt(a.substr(3,3).trim(),10),isNaN(this._b4)||isNaN(this._cT))return!1;this._3++;var d=""+(this._i.chains().length+1);this._cV=this._i.addChain(d),this._ca=this._cV.addResidue(this._cl,1)}if(4===b){for(var e=[0,0,0],f=0;3>f;++f)if(e[f]=parseFloat(a.substr(10*f,10).trim()),isNaN(e[f]))return!1;var g=a.substr(31,3).trim();this._ca.addAtom(g,e,g,!1),this._c5++,this._c5===this._b4&&this._3++}if(5===b){var h=parseInt(a.substr(0,3).trim(),10)-1,i=parseInt(a.substr(3,3).trim(),10)-1;if(isNaN(h)||isNaN(i))return!1;var j=this._ca.atoms();this._i.connect(j[h],j[i]),this._c3++,this._c3===this._cT&&this._3++}return"M  END"===a.substr(0,6)&&(this._bM=!0,this._3++),"$$$$"===a.substr(0,4)&&this._cs(),!0},_cs:function(){this._3=0,this._ca=null,this._cV=null,this._b4=null,this._ee=null,this._c5=0,this._c3=0,this._cl=""},finish:function(){return this._bM?this._i:null}},{pdb:g,sdf:i,Remark350Reader:c,fetchPdb:k,fetchSdf:l}}(A),K=function(){var b=a.vec3,c=a.mat3,d=function(){var a=b.create(),c=b.create();return function(d,e){b.set(a,0,0,0);var f=0;d.eachCentralAtom(function(c,d){b.add(a,a,d),f+=1}),0!==f&&(b.scale(a,a,1/f),e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0,d.eachCentralAtom(function(d,f){b.sub(c,f,a);var g=c[0],h=c[1],i=c[2];e[0]+=h*h+i*i,e[1]-=g*h,e[2]-=g*i,e[5]-=h*i,e[4]+=g*g+i*i,e[8]+=g*g+h*h}),e[3]=e[1],e[6]=e[2],e[7]=e[5])}}(),e=function(){var a=c.create(),e=c.create(),f=b.create(),g=b.create(),h=b.create(),i=b.create(),j=b.create(),l=b.create(),m=b.create();return function(n){d(n,a);var o=k.diagonalizer(a);c.fromQuat(e,o);var p=!0;n.eachCentralAtom(function(a,c){b.transformMat3(h,c,e),p?(b.copy(f,h),b.copy(g,h),p=!1):(b.min(f,f,h),b.max(g,g,h))}),b.sub(i,g,f);var q=[[i[0],0],[i[1],1],[i[2],2]];q.sort(function(a,b){return b[0]-a[0]});var r=q[0][1],s=q[1][1];b.set(j,e[r+0],e[r+3],e[r+6]),b.set(l,e[s+0],e[s+3],e[s+6]),b.cross(m,j,l);var t=c.create();return t[0]=j[0],t[1]=l[0],t[2]=m[0],t[3]=j[1],t[4]=l[1],t[5]=m[1],t[6]=j[2],t[7]=l[2],t[8]=m[2],t}}();return{principalAxes:e}}(),L=function(){return{Viewer:z.Viewer,isWebGLSupported:z.isWebGLSupported,io:J,color:b,mol:Q,rgb:{setColorPalette:b.setColorPalette,hex2rgb:b.hex2rgb},vec3:a.vec3,vec4:a.vec4,mat3:a.mat3,mat4:a.mat4,quat:a.quat,viewpoint:K}}()});